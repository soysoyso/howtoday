<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="/manifest.json">
<title>ê³ ì†ë„ë¡œ ì‘ì—…ê´€ë¦¬ v11.0</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
* {margin: 0;padding: 0;box-sizing: border-box;}
body {font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;background: #F5F7FA;color: #333;}
.page {display: none;min-height: 100vh;padding-bottom: 40px;}
.page.active {display: block;}
.header {background: linear-gradient(135deg, #1E5EBA 0%, #2B7DE9 100%);padding: 24px 20px 20px;box-shadow: 0 2px 12px rgba(30,94,186,0.15);}
.logo {font-size: 28px;font-weight: 800;color: white;margin-bottom: 6px;letter-spacing: 1.5px;}
.logo-red {color: #FF4444;}
.logo-yellow {color: #FFD700;}
.logo-green {color: #4CAF50;}
.tagline {font-size: 13px;color: rgba(255,255,255,0.9);font-weight: 500;margin-bottom: 16px;}
.header-info {display: flex;justify-content: space-between;align-items: center;padding-top: 12px;border-top: 1px solid rgba(255,255,255,0.2);}
.header-left {display: flex;flex-direction: column;gap: 4px;}
.datetime {font-size: 14px;color: rgba(255,255,255,0.95);font-weight: 600;}
.user-info {display: flex;align-items: center;gap: 8px;font-size: 13px;color: rgba(255,255,255,0.85);}
.dept-badge {background: rgba(255,255,255,0.25);padding: 4px 10px;border-radius: 12px;font-weight: 700;font-size: 12px;}
.settings-icon {width: 40px;height: 40px;background: rgba(255,255,255,0.15);border-radius: 12px;display: flex;align-items: center;justify-content: center;font-size: 22px;cursor: pointer;transition: all 0.2s;border: 1px solid rgba(255,255,255,0.2);}
.settings-icon:active {background: rgba(255,255,255,0.25);transform: scale(0.95);}
.queue-badge {padding: 14px 20px;margin: 0 20px;margin-top: -10px;margin-bottom: 20px;border-radius: 12px;font-size: 14px;font-weight: 700;text-align: center;box-shadow: 0 4px 12px rgba(0,0,0,0.1);display: none;cursor: pointer;}
.queue-badge.show {display: block;}
.queue-badge.normal {background: linear-gradient(135deg, #FFB300, #FFC107);color: #333;}
.queue-badge.warning {background: linear-gradient(135deg, #FF9800, #FF6B00);color: white;}

.main-action {padding: 0 20px 20px;}
.big-card {background: white;border-radius: 16px;padding: 32px 24px;box-shadow: 0 4px 16px rgba(0,0,0,0.08);cursor: pointer;transition: all 0.3s;border: 2px solid #E3F2FD;}
.big-card:active {transform: scale(0.98);}
.card-header {display: flex;align-items: center;justify-content: space-between;margin-bottom: 16px;}
.card-label {font-size: 12px;color: #1E5EBA;margin-bottom: 6px;font-weight: 700;text-transform: uppercase;letter-spacing: 1px;}
.card-title {font-size: 26px;font-weight: 800;color: #1E5EBA;}
.card-icon {font-size: 52px;}
.card-desc {font-size: 14px;color: #666;line-height: 1.5;}

.sub-actions {display: grid;grid-template-columns: 1fr 1fr;gap: 12px;padding: 0 20px 24px;}
.sub-card {background: white;border-radius: 14px;padding: 28px 20px;text-align: center;cursor: pointer;box-shadow: 0 2px 8px rgba(0,0,0,0.06);transition: all 0.3s;border: 2px solid #F0F0F0;}
.sub-card:active {transform: scale(0.96);}
.sub-card-icon {font-size: 46px;margin-bottom: 12px;}
.sub-card-title {font-size: 17px;font-weight: 700;color: #333;margin-bottom: 6px;}
.sub-card-desc {font-size: 12px;color: #999;}

.section {padding: 0 20px 24px;}
.section-title {font-size: 15px;font-weight: 700;color: #333;margin-bottom: 14px;}
.feature-grid {display: grid;grid-template-columns: repeat(4, 1fr);gap: 10px;}
.feature-card {background: white;border-radius: 12px;padding: 20px 14px;text-align: center;cursor: pointer;transition: all 0.3s;box-shadow: 0 2px 6px rgba(0,0,0,0.06);border: 2px solid #F5F5F5;}
.feature-card:active {transform: scale(0.94);}
.feature-icon {font-size: 32px;margin-bottom: 8px;}
.feature-name {font-size: 13px;font-weight: 600;color: #333;}

.stats-grid {display: grid;grid-template-columns: repeat(2, 1fr);gap: 12px;}
.stat-card {background: white;border-radius: 14px;padding: 22px 20px;text-align: center;cursor: pointer;transition: all 0.3s;box-shadow: 0 2px 8px rgba(0,0,0,0.06);border: 2px solid #F0F0F0;}
.stat-card:active {transform: scale(0.98);}
.stat-icon {font-size: 36px;margin-bottom: 10px;}
.stat-value {font-size: 28px;font-weight: 800;color: #1E5EBA;margin-bottom: 6px;}
.stat-label {font-size: 13px;color: #666;font-weight: 500;}

/* ìœ í˜•ë³„ í†µê³„ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.category-stats-grid {display: grid;grid-template-columns: 1fr;gap: 16px;margin-bottom: 20px;}
.category-stat-card {background: white;border-radius: 14px;padding: 20px;box-shadow: 0 2px 8px rgba(0,0,0,0.06);border-left: 4px solid #2196F3;}
.category-stat-card.facility {border-left-color: #FF9800;}
.category-stat-card.traffic {border-left-color: #4CAF50;}
.category-stat-card.road {border-left-color: #2196F3;}
.category-header {display: flex;justify-content: space-between;align-items: center;margin-bottom: 16px;}
.category-name {font-size: 18px;font-weight: 700;color: #333;}
.category-icon {font-size: 32px;}
.category-stats-row {display: grid;grid-template-columns: repeat(3, 1fr);gap: 12px;}
.category-stat-item {text-align: center;padding: 12px;background: #F8F9FA;border-radius: 8px;}
.category-stat-value {font-size: 20px;font-weight: 800;color: #1E5EBA;margin-bottom: 4px;}
.category-stat-label {font-size: 11px;color: #666;font-weight: 600;}
.status-complete {color: #4CAF50;}
.status-progress {color: #FF9800;}

.top-bar {padding: 18px 20px;display: flex;align-items: center;gap: 14px;background: white;box-shadow: 0 2px 8px rgba(0,0,0,0.06);}
.back-btn {background: none;border: none;color: #1E5EBA;font-size: 28px;cursor: pointer;padding: 6px;font-weight: bold;}
.page-title {font-size: 19px;font-weight: 700;color: #333;flex: 1;}

.form {padding: 24px 20px;}
.form-group {margin-bottom: 20px;}
.form-label {display: block;font-size: 14px;font-weight: 700;color: #333;margin-bottom: 10px;}
.required {color: #F44336;}
.form-input, .form-select, .form-textarea {width: 100%;padding: 14px 16px;border: 2px solid #E0E0E0;border-radius: 10px;background: white;color: #333;font-size: 15px;font-family: inherit;transition: border-color 0.2s;}
.form-input:focus, .form-select:focus, .form-textarea:focus {outline: none;border-color: #2B7DE9;}
.form-input:disabled, .form-select:disabled, .form-textarea:disabled {background: #F5F5F5;color: #999;}
.form-input::placeholder, .form-textarea::placeholder {color: #BBB;}
.form-select {cursor: pointer;}
.form-textarea {min-height: 120px;resize: vertical;line-height: 1.6;}

.datetime-grid {display: grid;grid-template-columns: 1fr 1fr;gap: 10px;margin-top: 12px;}
.datetime-item {display: flex;flex-direction: column;gap: 8px;}
.datetime-item label {font-size: 13px;color: #666;font-weight: 600;}
.datetime-input-group {display: flex;gap: 6px;}
.datetime-input-group input {flex: 1;padding: 12px;font-size: 14px;}

.photos {display: grid;grid-template-columns: repeat(3, 1fr);gap: 10px;margin-top: 12px;}
.photo {aspect-ratio: 1;background: #F5F5F5;border: 2px solid #E0E0E0;border-radius: 10px;position: relative;overflow: hidden;}
.photo img {width: 100%;height: 100%;object-fit: cover;}
.photo-remove {position: absolute;top: 6px;right: 6px;width: 26px;height: 26px;border-radius: 50%;background: rgba(244,67,54,0.95);color: white;border: none;font-size: 18px;cursor: pointer;z-index: 10;}
.add-photo-btn {aspect-ratio: 1;background: white;border: 2px dashed #CCC;border-radius: 10px;display: flex;flex-direction: column;align-items: center;justify-content: center;cursor: pointer;transition: all 0.3s;}
.add-photo-btn:active {border-color: #2B7DE9;background: #F0F7FF;}
.add-photo-icon {font-size: 34px;margin-bottom: 4px;}
.add-photo-text {font-size: 12px;color: #999;font-weight: 600;}

.submit {padding: 20px;background: white;box-shadow: 0 -2px 8px rgba(0,0,0,0.06);}
.submit-btn {width: 100%;padding: 18px;background: linear-gradient(135deg, #2B7DE9, #64B5F6);color: white;border: none;border-radius: 12px;font-size: 18px;font-weight: 700;cursor: pointer;transition: all 0.3s;box-shadow: 0 4px 12px rgba(43,125,233,0.3);}
.submit-btn:active {transform: scale(0.98);}
.submit-btn:disabled {background: #CCC;cursor: not-allowed;}

.modal {display: none;position: fixed;top: 0;left: 0;right: 0;bottom: 0;background: rgba(0,0,0,0.6);z-index: 1000;align-items: center;justify-content: center;}
.modal.show {display: flex;}
.modal-content {background: white;border-radius: 20px;padding: 28px 24px;width: 90%;max-width: 400px;box-shadow: 0 8px 32px rgba(0,0,0,0.2);}
.modal-title {font-size: 20px;font-weight: 700;color: #333;margin-bottom: 24px;text-align: center;}
.modal-buttons {display: flex;flex-direction: column;gap: 12px;}
.modal-btn {padding: 16px;border-radius: 12px;font-size: 16px;font-weight: 700;cursor: pointer;transition: all 0.3s;border: none;}
.modal-btn-primary {background: linear-gradient(135deg, #2B7DE9, #64B5F6);color: white;}
.modal-btn-secondary {background: #F5F5F5;color: #666;}
.modal-btn:active {transform: scale(0.98);}

.modal-content-large {background: white;border-radius: 20px;width: 90%;max-width: 500px;box-shadow: 0 8px 32px rgba(0,0,0,0.2);max-height: 85vh;display: flex;flex-direction: column;}
.modal-header {padding: 24px 24px 16px;border-bottom: 2px solid #F0F0F0;display: flex;justify-content: space-between;align-items: center;}
.modal-close {background: none;border: none;font-size: 32px;color: #999;cursor: pointer;padding: 0;width: 36px;height: 36px;display: flex;align-items: center;justify-content: center;transition: all 0.2s;}
.modal-close:hover {color: #333;}
.modal-body {padding: 24px;overflow-y: auto;flex: 1;}
.modal-footer {padding: 16px 24px;border-top: 2px solid #F0F0F0;display: flex;flex-direction: column;gap: 10px;}

.info-card {background: white;border-radius: 14px;padding: 32px 24px;margin: 16px 20px;text-align: center;box-shadow: 0 2px 8px rgba(0,0,0,0.06);}
.info-icon {font-size: 56px;margin-bottom: 16px;}
.info-title {font-size: 20px;font-weight: 700;color: #333;margin-bottom: 10px;}
.info-desc {font-size: 14px;color: #999;line-height: 1.6;}

.dispatch-status-card {background: linear-gradient(135deg, #667EEA, #764BA2);border-radius: 16px;padding: 24px 20px;margin: 0 20px 20px;box-shadow: 0 4px 16px rgba(102,126,234,0.3);}
.dispatch-status-text {font-size: 16px;color: rgba(255,255,255,0.9);margin-bottom: 12px;}
.dispatch-timer {font-size: 36px;font-weight: 800;color: white;text-align: center;letter-spacing: 2px;margin-bottom: 16px;}
.dispatch-info {background: rgba(255,255,255,0.15);border-radius: 12px;padding: 16px;margin-top: 16px;display: none;}
.dispatch-info.show {display: flex;justify-content: space-between;}
.dispatch-info-item {display: flex;flex-direction: column;gap: 4px;}
.dispatch-info-label {font-size: 11px;color: rgba(255,255,255,0.7);font-weight: 600;}
.dispatch-info-value {font-size: 15px;font-weight: 800;color: white;}
.dispatch-btn {width: 100%;padding: 18px;border: none;border-radius: 12px;font-size: 18px;font-weight: 700;cursor: pointer;transition: all 0.3s;box-shadow: 0 4px 12px rgba(0,0,0,0.2);}
.dispatch-btn.start {background: linear-gradient(135deg, #FF6F00, #FF8F00);color: white;}
.dispatch-btn.end {background: linear-gradient(135deg, #43A047, #66BB6A);color: white;}
.dispatch-btn:active {transform: scale(0.98);}

.mission-status-card {background: linear-gradient(135deg, #E91E63, #F06292);border-radius: 16px;padding: 24px 20px;margin: 0 20px 20px;box-shadow: 0 4px 16px rgba(233,30,99,0.3);}

.dispatch-history {margin-top: 24px;padding: 0 20px;}
.history-item {background: white;border-radius: 12px;padding: 16px;margin-bottom: 12px;box-shadow: 0 2px 8px rgba(0,0,0,0.06);border-left: 4px solid #FF9800;cursor: pointer;transition: all 0.2s;}
.history-item:active {transform: scale(0.98);background: #F8F9FA;}
.history-header {display: flex;justify-content: space-between;align-items: center;margin-bottom: 12px;}
.history-date {font-size: 15px;font-weight: 700;color: #333;}
.history-duration {font-size: 14px;font-weight: 800;color: #FF6F00;}
.history-times {display: flex;gap: 16px;font-size: 13px;color: #666;}
.history-time-item {display: flex;align-items: center;gap: 4px;}
.history-work-count {margin-top: 8px;padding: 6px 12px;background: #E8F5E9;border-radius: 6px;font-size: 12px;color: #2E7D32;font-weight: 600;text-align: center;}

.filter-tabs {display: flex;gap: 8px;padding: 16px 20px 12px;background: white;overflow-x: auto;border-bottom: 2px solid #F0F0F0;}
.filter-tab {padding: 8px 16px;border-radius: 20px;font-size: 14px;font-weight: 600;cursor: pointer;white-space: nowrap;transition: all 0.2s;border: 2px solid #E0E0E0;background: white;color: #666;}
.filter-tab.active {background: #2B7DE9;color: white;border-color: #2B7DE9;}

.date-filter {padding: 16px 20px;background: white;border-bottom: 2px solid #F0F0F0;}
.date-filter-title {font-size: 14px;font-weight: 700;color: #333;margin-bottom: 10px;}
.date-filter-inputs {display: grid;grid-template-columns: 1fr auto 1fr;gap: 8px;align-items: center;}
.date-filter-inputs input {padding: 10px;border: 2px solid #E0E0E0;border-radius: 8px;font-size: 14px;}
.date-filter-separator {font-size: 14px;color: #666;font-weight: 600;}

.list-header {padding: 18px 20px;background: white;box-shadow: 0 2px 6px rgba(0,0,0,0.04);}
.list-count {font-size: 16px;color: #1E5EBA;font-weight: 700;}

.work-list {padding: 16px 20px;}
.work-item {background: white;border-radius: 12px;padding: 18px;margin-bottom: 12px;box-shadow: 0 2px 8px rgba(0,0,0,0.06);border: 2px solid #F0F0F0;cursor: pointer;transition: all 0.2s;}
.work-item:active {transform: scale(0.98);background: #F8F9FA;}
.work-item.inspection {border-left: 4px solid #4CAF50;background: #F1F8F4;}
.work-item.work {border-left: 4px solid #2196F3;}
.work-item.dispatch {border-left: 4px solid #FF9800;background: #FFF8F0;}
.work-item.mission {border-left: 4px solid #E91E63;background: #FCE4EC;}
.work-item-header {display: flex;justify-content: space-between;align-items: flex-start;margin-bottom: 12px;}
.work-badge {padding: 5px 12px;border-radius: 10px;font-size: 12px;font-weight: 700;background: #2B7DE9;color: white;}
.work-badge.inspection {background: #4CAF50;}
.work-badge.dispatch {background: #FF9800;}
.work-badge.mission {background: #E91E63;}
.work-badge.work {background: #2196F3;}
.work-time {font-size: 13px;color: #666;font-weight: 600;}
.work-info {display: flex;flex-direction: column;gap: 8px;}
.work-location {font-size: 16px;font-weight: 700;color: #333;}
.work-detail {font-size: 14px;color: #666;line-height: 1.5;}
.work-meta {display: flex;gap: 12px;margin-top: 8px;font-size: 12px;color: #999;}
.work-photos-preview {display: flex;gap: 6px;margin-top: 8px;}
.work-photo-thumb {width: 60px;height: 60px;border-radius: 8px;overflow: hidden;border: 2px solid #E0E0E0;}
.work-photo-thumb img {width: 100%;height: 100%;object-fit: cover;}

.detail-section {padding: 20px;background: white;margin-bottom: 10px;}
.detail-title {font-size: 16px;font-weight: 700;color: #333;margin-bottom: 16px;padding-bottom: 12px;border-bottom: 2px solid #F0F0F0;}
.detail-item {margin-bottom: 16px;}
.detail-label {font-size: 13px;color: #666;font-weight: 600;margin-bottom: 6px;}
.detail-value {font-size: 15px;color: #333;line-height: 1.6;}
.detail-photos {display: grid;grid-template-columns: repeat(3, 1fr);gap: 10px;margin-top: 12px;}
.detail-photo {aspect-ratio: 1;background: #F5F5F5;border: 2px solid #E0E0E0;border-radius: 10px;overflow: hidden;cursor: pointer;}
.detail-photo img {width: 100%;height: 100%;object-fit: cover;}

.checklist {padding: 0;}
.checklist-item {padding: 18px 20px;border-bottom: 1px solid #F0F0F0;cursor: pointer;transition: all 0.2s;display: flex;align-items: center;gap: 14px;background: white;}
.checklist-item:active {background: #F8F9FA;}
.checklist-item.checked {background: #F1F8F4;}
.checklist-item input[type="checkbox"] {width: 24px;height: 24px;cursor: pointer;accent-color: #4CAF50;}
.checklist-label {font-size: 15px;color: #333;font-weight: 500;flex: 1;}

.settings-item {padding: 20px;background: white;border-radius: 12px;margin-bottom: 16px;box-shadow: 0 2px 8px rgba(0,0,0,0.06);}
.settings-item-title {font-size: 15px;font-weight: 700;color: #333;margin-bottom: 16px;}

.radio-group {display: flex;flex-direction: column;gap: 12px;}
.radio-option {padding: 16px;border: 2px solid #E0E0E0;border-radius: 10px;cursor: pointer;transition: all 0.2s;display: flex;align-items: center;gap: 12px;}
.radio-option.selected {border-color: #2B7DE9;background: #F0F7FF;}
.radio-option input[type="radio"] {width: 20px;height: 20px;cursor: pointer;accent-color: #2B7DE9;}
.radio-label {flex: 1;}
.radio-title {font-size: 15px;font-weight: 700;color: #333;margin-bottom: 4px;}
.radio-desc {font-size: 13px;color: #666;}

.checkbox-option {padding: 16px;border: 2px solid #E0E0E0;border-radius: 10px;cursor: pointer;transition: all 0.2s;display: flex;align-items: center;gap: 12px;margin-bottom: 12px;}
.checkbox-option.selected {border-color: #2B7DE9;background: #F0F7FF;}
.checkbox-option input[type="checkbox"] {width: 20px;height: 20px;cursor: pointer;accent-color: #2B7DE9;}

.warning-box {margin-top: 16px;padding: 16px;background: #FFF3E0;border-left: 4px solid #FF9800;border-radius: 8px;display: none;}
.warning-box.show {display: block;}
.warning-text {font-size: 14px;color: #E65100;font-weight: 600;line-height: 1.6;}

.queue-list {padding: 16px 20px;}
.queue-item {background: white;border-radius: 12px;padding: 18px;margin-bottom: 12px;box-shadow: 0 2px 8px rgba(0,0,0,0.06);border: 2px solid #FFE0B2;border-left: 4px solid #FF9800;}
.queue-item-header {display: flex;justify-content: space-between;align-items: center;margin-bottom: 12px;}
.queue-badge-small {padding: 5px 12px;border-radius: 10px;font-size: 12px;font-weight: 700;background: #FF9800;color: white;}
.queue-time {font-size: 13px;color: #666;font-weight: 600;}
.queue-info {display: flex;flex-direction: column;gap: 8px;}
.queue-location {font-size: 16px;font-weight: 700;color: #333;}
.queue-detail {font-size: 14px;color: #666;line-height: 1.5;}
.queue-actions {display: flex;gap: 8px;margin-top: 12px;}
.queue-action-btn {flex: 1;padding: 12px;border: none;border-radius: 8px;font-size: 14px;font-weight: 700;cursor: pointer;transition: all 0.2s;}
.queue-upload-btn {background: #4CAF50;color: white;}
.queue-delete-btn {background: #F44336;color: white;}
.queue-action-btn:active {transform: scale(0.96);}

.empty-state {text-align: center;padding: 60px 20px;}
.empty-icon {font-size: 64px;margin-bottom: 16px;opacity: 0.5;}
.empty-text {font-size: 16px;color: #999;font-weight: 600;}

.admin-indicator {display: inline-block;padding: 4px 10px;background: #FF6F00;color: white;border-radius: 6px;font-size: 11px;font-weight: 700;margin-left: 8px;}

/* ê·¼íƒœê´€ë¦¬ ê°œì„  */
.attendance-card {background: white;border-radius: 16px;padding: 24px 20px;margin: 0 20px 20px;box-shadow: 0 4px 16px rgba(0,0,0,0.08);border: 2px solid #E3F2FD;}
.attendance-user {font-size: 20px;font-weight: 800;color: #1E5EBA;margin-bottom: 16px;text-align: center;}
.attendance-status-grid {display: grid;grid-template-columns: 1fr 1fr;gap: 12px;margin-bottom: 16px;}
.attendance-status-item {text-align: center;padding: 16px;background: #F8F9FA;border-radius: 12px;}
.attendance-status-label {font-size: 12px;color: #666;margin-bottom: 6px;}
.attendance-status-value {font-size: 18px;font-weight: 800;color: #1E5EBA;}
.alcohol-status {display: inline-block;padding: 8px 16px;border-radius: 20px;font-size: 14px;font-weight: 700;margin-top: 8px;}
.alcohol-status.confirmed {background: #E8F5E9;color: #2E7D32;}
.alcohol-status.detected {background: #FFEBEE;color: #C62828;}

.attendance-list {padding: 16px 20px;}
.attendance-item {background: white;border-radius: 12px;padding: 18px;margin-bottom: 12px;box-shadow: 0 2px 8px rgba(0,0,0,0.06);border-left: 4px solid #1E5EBA;}
.attendance-header {display: flex;justify-content: space-between;align-items: center;margin-bottom: 12px;}
.attendance-name {font-size: 16px;font-weight: 700;color: #333;}
.attendance-status {padding: 4px 10px;border-radius: 8px;font-size: 12px;font-weight: 700;}
.attendance-status.working {background: #E8F5E9;color: #2E7D32;}
.attendance-status.off {background: #F5F5F5;color: #999;}
.attendance-times {display: flex;gap: 16px;font-size: 13px;color: #666;margin-top: 8px;}
.alcohol-badge {display: inline-block;padding: 4px 8px;border-radius: 6px;font-size: 11px;font-weight: 700;margin-left: 8px;}
.alcohol-badge.confirmed {background: #E8F5E9;color: #2E7D32;}
.alcohol-badge.detected {background: #FFEBEE;color: #C62828;}
.leave-badge {display: inline-block;padding: 4px 8px;border-radius: 6px;font-size: 11px;font-weight: 700;margin-left: 8px;background: #FFF3E0;color: #E65100;}

.action-buttons {padding: 20px;display: flex;gap: 10px;}
.action-btn {flex: 1;padding: 16px;border: none;border-radius: 12px;font-size: 16px;font-weight: 700;cursor: pointer;transition: all 0.3s;}
.action-btn-primary {background: linear-gradient(135deg, #2B7DE9, #64B5F6);color: white;}
.action-btn-secondary {background: #F5F5F5;color: #666;}
.action-btn:active {transform: scale(0.98);}

.edit-mode-indicator {background: #FFF3E0;padding: 12px 20px;border-left: 4px solid #FF9800;margin: 0 20px 20px;border-radius: 8px;font-size: 14px;color: #E65100;font-weight: 600;}

/* ì¼ì¼ ì ê²€ì¼ì§€ íƒ­ ìŠ¤íƒ€ì¼ */
.inspection-tabs {display: flex;gap: 8px;padding: 16px 20px;background: white;border-bottom: 2px solid #F0F0F0;overflow-x: auto;}
.inspection-tab {padding: 10px 20px;border-radius: 20px;font-size: 14px;font-weight: 600;cursor: pointer;white-space: nowrap;transition: all 0.2s;border: 2px solid #E0E0E0;background: white;color: #666;}
.inspection-tab.active {background: #4CAF50;color: white;border-color: #4CAF50;}

.inspection-content {display: none;}
.inspection-content.active {display: block;}

.checklist-summary {padding: 16px 20px;background: #F8F9FA;border-bottom: 2px solid #E0E0E0;}
.summary-text {font-size: 14px;color: #666;text-align: center;}
.summary-count {font-weight: 800;color: #4CAF50;font-size: 18px;}

/* ì°¨íŠ¸ ê´€ë ¨ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
.stats-filter-tabs {display: flex;gap: 8px;padding: 16px 20px;background: white;overflow-x: auto;border-bottom: 2px solid #F0F0F0;margin-bottom: 0;}
.stats-filter-tab {padding: 8px 16px;border-radius: 20px;font-size: 14px;font-weight: 600;cursor: pointer;white-space: nowrap;transition: all 0.2s;border: 2px solid #E0E0E0;background: white;color: #666;}
.stats-filter-tab.active {background: #2B7DE9;color: white;border-color: #2B7DE9;}
.chart-container {background: white;border-radius: 14px;padding: 20px;margin-bottom: 20px;box-shadow: 0 2px 8px rgba(0,0,0,0.06);}
.chart-title {font-size: 16px;font-weight: 700;color: #333;margin-bottom: 16px;padding-bottom: 12px;border-bottom: 2px solid #F0F0F0;}
.chart-wrapper {position: relative;height: 280px;}
canvas {max-height: 280px;}


/* ì¼ì¼ì ê²€ ì‘ì—… ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
.work-item.daily-inspection {border-left: 4px solid #9C27B0;background: #F3E5F5;}
.work-badge.daily-inspection {background: #9C27B0;}

/* ë³´ê³ ì„œ ì¶œë ¥ ì „ìš© ìŠ¤íƒ€ì¼ */
@media print {
  .header, .top-bar, .submit, .action-buttons, .no-print {
    display: none !important;
  }
  
  .report-page {
    display: block !important;
    page-break-after: always;
  }
  
  body {
    background: white;
  }
  
  .report-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
  }
  
  .report-table th,
  .report-table td {
    border: 1px solid #333;
    padding: 8px;
    font-size: 11px;
  }
}

/* ë³´ê³ ì„œ ìŠ¤íƒ€ì¼ */
.report-container {
  background: white;
  padding: 40px;
  max-width: 1000px;
  margin: 0 auto;
}

.report-header {
  text-align: center;
  margin-bottom: 40px;
  padding-bottom: 20px;
  border-bottom: 3px solid #1E5EBA;
}

.report-title {
  font-size: 28px;
  font-weight: 800;
  color: #1E5EBA;
  margin-bottom: 10px;
}

.report-subtitle {
  font-size: 18px;
  color: #666;
  margin-bottom: 20px;
}

.report-date {
  font-size: 14px;
  color: #999;
}

.report-section {
  margin-bottom: 30px;
}

.report-section-title {
  font-size: 20px;
  font-weight: 700;
  color: #333;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 2px solid #E0E0E0;
}

.report-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

.report-table th {
  background: #F5F7FA;
  padding: 12px;
  text-align: left;
  font-weight: 700;
  border: 1px solid #E0E0E0;
  font-size: 13px;
}

.report-table td {
  padding: 12px;
  border: 1px solid #E0E0E0;
  font-size: 13px;
}

.report-table tr:hover {
  background: #F8F9FA;
}

.report-summary-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.report-summary-card {
  background: #F8F9FA;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  border-left: 4px solid #2B7DE9;
}

.report-summary-label {
  font-size: 14px;
  color: #666;
  margin-bottom: 10px;
}

.report-summary-value {
  font-size: 32px;
  font-weight: 800;
  color: #1E5EBA;
}

.report-footer {
  margin-top: 50px;
  padding-top: 20px;
  border-top: 2px solid #E0E0E0;
  text-align: right;
}

.report-signature {
  display: inline-block;
  margin-left: 40px;
}

.report-signature-label {
  font-size: 14px;
  color: #666;
  margin-right: 10px;
}

.report-signature-value {
  font-size: 16px;
  font-weight: 700;
  color: #333;
}

.report-actions {
  padding: 20px;
  background: white;
  box-shadow: 0 -2px 8px rgba(0,0,0,0.06);
  display: flex;
  gap: 10px;
}

.report-btn {
  flex: 1;
  padding: 16px;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
}

.report-btn-print {
  background: linear-gradient(135deg, #2B7DE9, #64B5F6);
  color: white;
}

.report-btn-close {
  background: #F5F5F5;
  color: #666;
}

.report-btn:active {
  transform: scale(0.98);
}


/* í†µê³„ ë³´ê³ ì„œ ì„¹ì…˜ */
.stats-report-section {
  background: white;
  padding: 20px;
  margin: 16px 20px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}

.stats-report-title {
  font-size: 16px;
  font-weight: 700;
  color: #333;
  margin-bottom: 16px;
}

.stats-date-range {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 12px;
  align-items: end;
  margin-bottom: 16px;
}

.stats-date-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.stats-date-item label {
  font-size: 13px;
  color: #666;
  font-weight: 600;
}

.stats-date-separator {
  font-size: 16px;
  color: #666;
  font-weight: 700;
  padding-bottom: 14px;
}

.stats-report-btn {
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, #2B7DE9, #64B5F6);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(43,125,233,0.3);
}

.stats-report-btn:active {
  transform: scale(0.98);
}

/* ë³´ê³ ì„œ ì‚¬ì§„ ê·¸ë¦¬ë“œ */
.report-photo-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin-top: 20px;
}

.report-photo-item {
  border: 1px solid #E0E0E0;
  border-radius: 10px;
  overflow: hidden;
  page-break-inside: avoid;
}

.report-photo-img {
  width: 100%;
  height: 250px;
  object-fit: cover;
  background: #F5F5F5;
}

.report-photo-info {
  padding: 12px;
  background: #F8F9FA;
}

.report-photo-label {
  font-size: 11px;
  color: #666;
  margin-bottom: 4px;
}

.report-photo-value {
  font-size: 13px;
  font-weight: 600;
  color: #333;
}

/* í†µí•© ë³´ê³ ì„œ êµ¬ë¶„ì„  */
.report-divider {
  margin: 40px 0;
  border: 0;
  border-top: 3px solid #E0E0E0;
  page-break-after: always;
}

.report-type-section {
  margin-bottom: 50px;
  page-break-inside: avoid;
}

.report-type-header {
  background: linear-gradient(135deg, #F5F7FA, #E3F2FD);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
  border-left: 4px solid #2B7DE9;
}

.report-type-title {
  font-size: 24px;
  font-weight: 800;
  color: #1E5EBA;
  margin-bottom: 8px;
}

.report-type-count {
  font-size: 14px;
  color: #666;
}

</style>
</head>
<body>

<!-- í™ˆ í˜ì´ì§€ -->
<div id="home" class="page active">
  <div class="header">
    <div class="logo">
      ê³ ì†ë„ë¡œ <span class="logo-red">ì‘</span><span class="logo-yellow">ì—…</span><span class="logo-green">ê´€</span>ë¦¬
    </div>
    <div class="tagline">ğŸ“ ìŠ¤ë§ˆíŠ¸ í˜„ì¥ ê´€ë¦¬ ì‹œìŠ¤í…œ v11.0</div>
    <div class="header-info">
      <div class="header-left">
        <div class="datetime" id="datetime">2025.01.01 (ìˆ˜) 09:00</div>
        <div class="user-info">
          <span id="userName">ê¹€í˜„ì¥ ë‹˜</span>
          <span class="dept-badge" id="userDept">ê´€ë¦¬íŒ€</span>
        </div>
      </div>
      <div class="settings-icon" onclick="goToSettings()">âš™ï¸</div>
    </div>
  </div>
  
  <div class="queue-badge" id="queueBadge" onclick="goToQueue()">
    ğŸ“¦ ëŒ€ê¸° ì¤‘ì¸ ì‘ì—… <span id="queueCount">0</span>ê±´
  </div>
  
  <div class="main-action">
    <div class="big-card" onclick="goToWork()">
      <div class="card-header">
        <div>
          <div class="card-label">ì‘ì—… ë“±ë¡</div>
          <div class="card-title">ìƒì„¸ ì ‘ìˆ˜</div>
        </div>
        <div class="card-icon">ğŸ“</div>
      </div>
      <div class="card-desc">ì‘ì—… ìœ„ì¹˜, ì¼ì‹œ, ë‚´ìš©ì„ ìƒì„¸í•˜ê²Œ ë“±ë¡í•©ë‹ˆë‹¤</div>
    </div>
  </div>
  
  <div class="sub-actions">
    <div class="sub-card" onclick="goToSimple()">
      <div class="sub-card-icon">âš¡</div>
      <div class="sub-card-title">ê°„ë‹¨ ì ‘ìˆ˜</div>
      <div class="sub-card-desc">ì‚¬ì§„ìœ¼ë¡œ ë¹ ë¥´ê²Œ ë“±ë¡</div>
    </div>
    <div class="sub-card" onclick="goToDailyInspection()">
      <div class="sub-card-icon">ğŸ“‹</div>
      <div class="sub-card-title">ì¼ì¼ ì ê²€ì¼ì§€</div>
      <div class="sub-card-desc">ì²´í¬ë¦¬ìŠ¤íŠ¸ ì ê²€</div>
    </div>
  </div>
  
  <div class="section">
    <div class="section-title">ë¹ ë¥¸ ë©”ë‰´</div>
    <div class="feature-grid">
      <div class="feature-card" onclick="goToList()">
        <div class="feature-icon">ğŸ“‹</div>
        <div class="feature-name">ì‘ì—… ëª©ë¡</div>
      </div>
      <div class="feature-card" onclick="goToStats()">
        <div class="feature-icon">ğŸ“Š</div>
        <div class="feature-name">í†µê³„</div>
      </div>
      <div class="feature-card" onclick="goToMission()">
        <div class="feature-icon">ğŸš¨</div>
        <div class="feature-name">ì¶œë™/ë³µê·€</div>
      </div>
      <div class="feature-card" onclick="goToAttendance()">
        <div class="feature-icon">â°</div>
        <div class="feature-name">ê·¼íƒœê´€ë¦¬</div>
      </div>
    </div>
  </div>
</div>

<!-- ìƒì„¸ ì ‘ìˆ˜ í˜ì´ì§€ -->
<div id="work" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="cancelWorkEdit()">â†</button>
    <div class="page-title" id="workPageTitle">ğŸ“ ìƒì„¸ ì‘ì—… ì ‘ìˆ˜</div>
  </div>
  
  <div class="edit-mode-indicator" id="editModeIndicator" style="display: none;">
    âœï¸ ìˆ˜ì • ëª¨ë“œ
  </div>
  
  <div class="form">
    <div class="form-group">
      <label class="form-label">ì‘ì—… ìƒíƒœ</label>
      <select id="workStatus" class="form-select">
        <option value="pending">ì‘ì—…ì˜ˆì •</option>
        <option value="inprogress">ì‘ì—…ì¤‘</option>
        <option value="completed">ì‘ì—…ì™„ë£Œ</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">ì‘ì—… êµ¬ë¶„ <span class="required">*</span></label>
      <select id="workCategory" class="form-select">
        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
        <option value="ì‹œì„¤">ì‹œì„¤</option>
        <option value="êµí†µ">êµí†µ</option>
        <option value="ë„ë¡œ">ë„ë¡œ</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">ì‘ì—… ìœ„ì¹˜ <span class="required">*</span></label>
      <input type="text" id="locationInput" class="form-input" placeholder="ì˜ˆ: ê°•ë‚¨ëŒ€ë¡œ 100km">
    </div>
    <div class="form-group">
      <label class="form-label">ì‘ì—… ìœ í˜• <span class="required">*</span></label>
      <select id="workType" class="form-select">
        <option>ì„ íƒí•´ì£¼ì„¸ìš”</option>
        <option>ë„ë¡œ ë³´ìˆ˜</option>
        <option>ì‹œì„¤ë¬¼ ì ê²€</option>
        <option>ì²­ì†Œ ì‘ì—…</option>
        <option>ì œì„¤ ì‘ì—…</option>
        <option>ê¸´ê¸‰ ë³´ìˆ˜</option>
        <option>ê¸°íƒ€</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">ì‘ì—… ì¼ì‹œ</label>
      <div class="datetime-grid">
        <div class="datetime-item">
          <label>ì‹œì‘</label>
          <div class="datetime-input-group">
            <input type="date" id="startDate" class="form-input">
            <input type="time" id="startTime" class="form-input">
          </div>
        </div>
        <div class="datetime-item">
          <label>ì¢…ë£Œ</label>
          <div class="datetime-input-group">
            <input type="date" id="endDate" class="form-input">
            <input type="time" id="endTime" class="form-input">
          </div>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">íˆ¬ì… ìì›</label>
      <input type="text" id="workResources" class="form-input" placeholder="ì˜ˆ: ì¥ë¹„ 2ëŒ€, ì°¨ëŸ‰ 1ëŒ€">
    </div>
    <div class="form-group">
      <label class="form-label">íˆ¬ì… ì¸ë ¥</label>
      <input type="text" id="workers" class="form-input" placeholder="ì˜ˆ: 5ëª…">
    </div>
    <div class="form-group">
      <label class="form-label">ì‘ì—… ë‚´ìš© <span class="required">*</span></label>
      <textarea id="workDetail" class="form-textarea" placeholder="ì‘ì—… ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">í˜„ì¥ ì‚¬ì§„ (<span id="num">0</span>/5)</label>
      <div class="photos" id="pics">
        <div class="add-photo-btn" onclick="showPhotoModal()">
          <div class="add-photo-icon">ğŸ“·</div>
          <div class="add-photo-text">ì¶”ê°€</div>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">ë‹´ë‹¹ìëª…</label>
      <input type="text" id="managerName" class="form-input" value="ê¹€í˜„ì¥">
    </div>
  </div>
  <div class="submit">
    <button class="submit-btn" id="workSubmitBtn" onclick="submitWork()">ğŸ“ ì‘ì—… ë“±ë¡</button>
  </div>
</div>

<!-- ê°„ë‹¨ ì ‘ìˆ˜ í˜ì´ì§€ -->
<div id="simple" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goToHome()">â†</button>
    <div class="page-title">âš¡ ê°„ë‹¨ ì ‘ìˆ˜</div>
  </div>
  <div class="form">
    <div class="form-group">
      <label class="form-label">ì‘ì—… êµ¬ë¶„</label>
      <select id="simpleCa tegory" class="form-select">
        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
        <option value="ì‹œì„¤">ì‹œì„¤</option>
        <option value="êµí†µ">êµí†µ</option>
        <option value="ë„ë¡œ">ë„ë¡œ</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">ì‘ì—… ìœ„ì¹˜</label>
      <input type="text" id="simpleLocation" class="form-input" placeholder="ì˜ˆ: ê°•ë‚¨ëŒ€ë¡œ 100km">
    </div>
    <div class="form-group">
      <label class="form-label">í˜„ì¥ ì‚¬ì§„ (ìµœì†Œ 1ì¥ í•„ìˆ˜)</label>
      <div class="photos" id="pics-simple">
        <div class="add-photo-btn" onclick="showPhotoModalSimple()">
          <div class="add-photo-icon">ğŸ“·</div>
          <div class="add-photo-text">ì¶”ê°€</div>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">ë‹´ë‹¹ìëª…</label>
      <input type="text" id="simpleManagerName" class="form-input" value="ê¹€í˜„ì¥">
    </div>
  </div>
  <div class="submit">
    <button class="submit-btn" onclick="submitSimple()">âš¡ ê°„ë‹¨ ë“±ë¡</button>
  </div>
</div>

<!-- ì¼ì¼ ì ê²€ì¼ì§€ í˜ì´ì§€ (ì‹ ê·œ) -->
<div id="dailyInspection" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goToHome()">â†</button>
    <div class="page-title">ğŸ“‹ ì¼ì¼ ì ê²€ì¼ì§€</div>
  </div>
  
  <div class="inspection-tabs">
    <div class="inspection-tab active" onclick="switchInspectionTab(0)">ğŸ—ï¸ ì‹œì„¤ì ê²€</div>
    <div class="inspection-tab" onclick="switchInspectionTab(1)">ğŸš§ í˜„ì¥ì ê²€</div>
    <div class="inspection-tab" onclick="switchInspectionTab(2)">ğŸ”§ ì¥ë¹„ì ê²€</div>
  </div>
  
  <!-- ì‹œì„¤ì ê²€ íƒ­ -->
  <div class="inspection-content active" id="facilityInspection">
    <div class="checklist-summary">
      <div class="summary-text">ì²´í¬: <span class="summary-count" id="facilitySummary">0/10</span> í•­ëª©</div>
    </div>
    <div class="checklist">
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">íœ´ê²Œì†Œ í™”ì¥ì‹¤ ì²­ê²° ìƒíƒœ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">íœ´ê²Œì†Œ ë§¤ì  ìš´ì˜ ìƒíƒœ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">ì£¼ì°¨ì¥ ì¡°ëª… ì‘ë™ ì—¬ë¶€</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">CCTV ì¹´ë©”ë¼ ì‘ë™ ìƒíƒœ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">ë¹„ìƒë²¨ ì‘ë™ ì ê²€</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">ì†Œí™”ê¸° ìœ„ì¹˜ ë° ìœ íš¨ê¸°ê°„</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">ë¹„ìƒêµ¬ ì•ˆë‚´í‘œì§€íŒ ìƒíƒœ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">ë°©ì†¡ì‹œì„¤ ì‘ë™ ì—¬ë¶€</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">ì „ê´‘íŒ í‘œì‹œ ìƒíƒœ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'facility')">
        <input type="checkbox">
        <div class="checklist-label">ë³´ì•ˆì‹œì„¤ ì´ìƒ ìœ ë¬´</div>
      </div>
    </div>
  </div>
  
  <!-- í˜„ì¥ì ê²€ íƒ­ -->
  <div class="inspection-content" id="siteInspection">
    <div class="checklist-summary">
      <div class="summary-text">ì²´í¬: <span class="summary-count" id="siteSummary">0/12</span> í•­ëª©</div>
    </div>
    <div class="checklist">
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">ë„ë¡œ í‘œë©´ ê· ì—´ ë° íŒŒì†</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">ì¤‘ì•™ë¶„ë¦¬ëŒ€ ì†ìƒ ì—¬ë¶€</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">ë°©ìŒë²½ íŒŒì† ë° ê¸°ìš¸ì–´ì§</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">ê°€ë“œë ˆì¼ ë³€í˜• ë° íŒŒì†</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">ë…¸ë©´í‘œì‹œ ìƒíƒœ (ì°¨ì„ , í™”ì‚´í‘œ)</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">í‘œì§€íŒ ì‹œì•¼ í™•ë³´ ë° ì†ìƒ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">ê°“ê¸¸ ì²­ê²° ìƒíƒœ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">ë°°ìˆ˜ë¡œ ë° ë§¨í™€ ë§‰í˜</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">ë‚™í•˜ë¬¼ ë° ì“°ë ˆê¸°</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">í„°ë„ ë‚´ ì¡°ëª… ìƒíƒœ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">êµëŸ‰ ì´ìŒë§¤ ë° ì‹ ì¶•ì´ìŒë¶€</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'site')">
        <input type="checkbox">
        <div class="checklist-label">ë¹„íƒˆë©´ ì‹ìƒ ë° ë‚™ì„ ë°©ì§€ë§</div>
      </div>
    </div>
  </div>
  
  <!-- ì¥ë¹„ì ê²€ íƒ­ -->
  <div class="inspection-content" id="equipmentInspection">
    <div class="checklist-summary">
      <div class="summary-text">ì²´í¬: <span class="summary-count" id="equipmentSummary">0/8</span> í•­ëª©</div>
    </div>
    <div class="checklist">
      <div class="checklist-item" onclick="toggleCheck(this, 'equipment')">
        <input type="checkbox">
        <div class="checklist-label">ì‘ì—…ì°¨ëŸ‰ ì‹œë™ ë° ìš´í–‰ ìƒíƒœ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'equipment')">
        <input type="checkbox">
        <div class="checklist-label">íƒ€ì´ì–´ ê³µê¸°ì•• ë° ë§ˆëª¨ë„</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'equipment')">
        <input type="checkbox">
        <div class="checklist-label">ë¸Œë ˆì´í¬ ì‘ë™ ìƒíƒœ</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'equipment')">
        <input type="checkbox">
        <div class="checklist-label">ì—”ì§„ì˜¤ì¼ ë° ëƒ‰ê°ìˆ˜ ì ê²€</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'equipment')">
        <input type="checkbox">
        <div class="checklist-label">ê²½ê´‘ë“± ë° ì•ˆì „ë“± ì‘ë™</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'equipment')">
        <input type="checkbox">
        <div class="checklist-label">ë¬´ì „ê¸° ë° í†µì‹ ì¥ë¹„ í…ŒìŠ¤íŠ¸</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'equipment')">
        <input type="checkbox">
        <div class="checklist-label">ì•ˆì „ì¥êµ¬ (ì•ˆì „ëª¨, ì¡°ë¼) êµ¬ë¹„</div>
      </div>
      <div class="checklist-item" onclick="toggleCheck(this, 'equipment')">
        <input type="checkbox">
        <div class="checklist-label">ê³µêµ¬ ë° ì‘ê¸‰ì¥ë¹„ íœ´ëŒ€ ì—¬ë¶€</div>
      </div>
    </div>
  </div>
  
  <div class="form" style="padding-top: 0;">
    <div class="form-group">
      <label class="form-label">íŠ¹ì´ì‚¬í•­</label>
      <textarea id="dailyInspectionNote" class="form-textarea" placeholder="íŠ¹ì´ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">ì ê²€ì</label>
      <input type="text" id="dailyInspectionManager" class="form-input" value="ê¹€í˜„ì¥">
    </div>
  </div>
  <div class="submit">
    <button class="submit-btn" onclick="submitDailyInspection()">âœ… ì ê²€ ì™„ë£Œ</button>
  </div>
</div>

<!-- ê¸°ë³¸ ì ê²€ í˜ì´ì§€ (ê¸°ì¡´) -->
<div id="inspection" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goToHome()">â†</button>
    <div class="page-title">âœ… ê¸°ë³¸ ì ê²€</div>
  </div>
  <div class="form">
    <div class="form-group">
      <label class="form-label">ì ê²€ ë„ë¡œ <span class="required">*</span></label>
      <select id="inspectionRoad" class="form-select">
        <option>ì„ íƒí•´ì£¼ì„¸ìš”</option>
        <option>ê°•ë‚¨ëŒ€ë¡œ</option>
        <option>í…Œí—¤ë€ë¡œ</option>
        <option>ì˜¬ë¦¼í”½ëŒ€ë¡œ</option>
        <option>ê°•ë³€ë¶ë¡œ</option>
        <option>ë‚´ë¶€ìˆœí™˜ë¡œ</option>
      </select>
    </div>
  </div>
  <div class="checklist">
    <div class="checklist-item" onclick="toggleCheck(this)">
      <input type="checkbox">
      <div class="checklist-label">ë„ë¡œ í‘œë©´ ìƒíƒœ í™•ì¸</div>
    </div>
    <div class="checklist-item" onclick="toggleCheck(this)">
      <input type="checkbox">
      <div class="checklist-label">ì¤‘ì•™ë¶„ë¦¬ëŒ€ ì ê²€</div>
    </div>
    <div class="checklist-item" onclick="toggleCheck(this)">
      <input type="checkbox">
      <div class="checklist-label">ë°©ìŒë²½ ìƒíƒœ í™•ì¸</div>
    </div>
    <div class="checklist-item" onclick="toggleCheck(this)">
      <input type="checkbox">
      <div class="checklist-label">í‘œì§€íŒ ë° ì•ˆë‚´íŒ ì ê²€</div>
    </div>
    <div class="checklist-item" onclick="toggleCheck(this)">
      <input type="checkbox">
      <div class="checklist-label">ì¡°ëª… ì‹œì„¤ ì ê²€</div>
    </div>
    <div class="checklist-item" onclick="toggleCheck(this)">
      <input type="checkbox">
      <div class="checklist-label">ë°°ìˆ˜ë¡œ ë° ë§¨í™€ ì ê²€</div>
    </div>
    <div class="checklist-item" onclick="toggleCheck(this)">
      <input type="checkbox">
      <div class="checklist-label">ê°“ê¸¸ ìƒíƒœ í™•ì¸</div>
    </div>
    <div class="checklist-item" onclick="toggleCheck(this)">
      <input type="checkbox">
      <div class="checklist-label">CCTV ì‘ë™ ìƒíƒœ</div>
    </div>
  </div>
  <div class="form" style="padding-top: 0;">
    <div class="form-group">
      <label class="form-label">íŠ¹ì´ì‚¬í•­</label>
      <textarea id="inspectionNote" class="form-textarea" placeholder="íŠ¹ì´ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">ì ê²€ì</label>
      <input type="text" id="inspectionManager" class="form-input" value="ê¹€í˜„ì¥">
    </div>
  </div>
  <div class="submit">
    <button class="submit-btn" onclick="submitInspection()">âœ… ì ê²€ ì™„ë£Œ</button>
  </div>
</div>

<!-- ì¶œë™/ë³µê·€ í˜ì´ì§€ -->
<div id="mission" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goToHome()">â†</button>
    <div class="page-title">ğŸš¨ ì¶œë™/ë³µê·€ ê´€ë¦¬</div>
  </div>
  
  <div class="mission-status-card">
    <div class="dispatch-status-text">ğŸš¨ ì¶œë™ ì‹œê°„</div>
    <div class="dispatch-timer" id="missionTimer">00:00:00</div>
    <div class="dispatch-info" id="missionInfo">
      <div class="dispatch-info-item">
        <div class="dispatch-info-label">ì¶œë™ ì‹œê°</div>
        <div class="dispatch-info-value" id="missionStartTime">--:--</div>
      </div>
      <div class="dispatch-info-item">
        <div class="dispatch-info-label">ì¶œë™ ì‹œê°„</div>
        <div class="dispatch-info-value" id="missionDuration">0ì‹œê°„</div>
      </div>
    </div>
    <button class="dispatch-btn start" id="missionBtn" onclick="toggleMission()">
      ğŸš¨ ì¶œë™í•˜ê¸°
    </button>
  </div>
  
  <div class="dispatch-history" id="missionHistory"></div>
</div>

<!-- ê·¼íƒœê´€ë¦¬ í˜ì´ì§€ -->
<div id="attendance" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goToHome()">â†</button>
    <div class="page-title">â° ê·¼íƒœ ê´€ë¦¬</div>
  </div>
  
  <!-- ë³¸ì¸ ê·¼íƒœ ì¹´ë“œ -->
  <div class="attendance-card" id="myAttendanceCard">
    <div class="attendance-user" id="attendanceUserName">ê¹€í˜„ì¥</div>
    <div class="attendance-status-grid">
      <div class="attendance-status-item">
        <div class="attendance-status-label">ì¶œê·¼ ì‹œê°</div>
        <div class="attendance-status-value" id="myCheckInTime">ë¯¸ë“±ë¡</div>
      </div>
      <div class="attendance-status-item">
        <div class="attendance-status-label">í‡´ê·¼ ì‹œê°</div>
        <div class="attendance-status-value" id="myCheckOutTime">ë¯¸ë“±ë¡</div>
      </div>
    </div>
    <div style="text-align: center;" id="myAlcoholStatus"></div>
  </div>
  
  <div class="action-buttons">
    <button class="action-btn action-btn-primary" onclick="showCheckInModal()">ğŸ¢ ì¶œê·¼í•˜ê¸°</button>
    <button class="action-btn action-btn-secondary" onclick="showCheckOutModal()">ğŸ  í‡´ê·¼í•˜ê¸°</button>
  </div>
  
  <!-- ê´€ë¦¬ì ì „ìš© ê·¼íƒœ ëª©ë¡ -->
  <div id="adminAttendanceSection" style="display: none;">
    <div class="section" style="padding-top: 0;">
      <div class="section-title">ì „ì²´ ê·¼íƒœ í˜„í™© (ê´€ë¦¬ì)</div>
    </div>
    <div class="attendance-list" id="allAttendanceList"></div>
  </div>
</div>

<!-- ì‘ì—… ëª©ë¡ í˜ì´ì§€ -->
<div id="list" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goToHome()">â†</button>
    <div class="page-title">ğŸ“‹ ì‘ì—… ëª©ë¡</div>
  </div>
  
  <div class="filter-tabs">
    <div class="filter-tab active" onclick="filterWorks('all')">ì „ì²´</div>
    <div class="filter-tab" onclick="filterWorks('my')">ë‚´ ì‘ì—…</div>
    <div class="filter-tab" onclick="filterWorks('mission')">ì¶œë™</div>
    <div class="filter-tab" onclick="filterWorks('dailyInspection')">ì¼ì¼ì ê²€</div>
    <div class="filter-tab" onclick="filterWorks('inspection')">ì ê²€</div>
    <div class="filter-tab" onclick="filterWorks('work')">ì‘ì—…</div>
  </div>
  
  <div class="date-filter">
    <div class="date-filter-title">ğŸ“… ê¸°ê°„ ì¡°íšŒ</div>
    <div class="date-filter-inputs">
      <input type="date" id="filterStartDate" onchange="applyDateFilter()">
      <div class="date-filter-separator">~</div>
      <input type="date" id="filterEndDate" onchange="applyDateFilter()">
    </div>
  </div>
  
  <div class="list-header">
    <div class="list-count" id="periodText">ì „ì²´ ì‘ì—… <span id="workCount">0</span>ê±´</div>
  </div>
  
  <div class="work-list" id="workListContainer"></div>
</div>

<!-- í†µê³„ í˜ì´ì§€ (ê°œì„ ) -->
<div id="stats" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goToHome()">â†</button>
    <div class="page-title">ğŸ“Š í†µê³„</div>
  </div>
  
  <!-- ê¸°ê°„ í•„í„° íƒ­ -->
  <div class="stats-filter-tabs">
    <div class="stats-filter-tab active" onclick="filterStatsPeriod('daily')">ì¼ê°„</div>
    <div class="stats-filter-tab" onclick="filterStatsPeriod('weekly')">ì£¼ê°„</div>
    <div class="stats-filter-tab" onclick="filterStatsPeriod('monthly')">ì›”ê°„</div>
  </div>
  
  <!-- ë³´ê³ ì„œ ê¸°ê°„ ì„ íƒ -->
  <div class="stats-report-section">
    <div class="stats-report-title">ğŸ“„ í†µí•© ë³´ê³ ì„œ ìƒì„±</div>
    <div class="stats-date-range">
      <div class="stats-date-item">
        <label>ì‹œì‘ì¼</label>
        <input type="date" id="reportStartDate" class="form-input">
      </div>
      <div class="stats-date-separator">~</div>
      <div class="stats-date-item">
        <label>ì¢…ë£Œì¼</label>
        <input type="date" id="reportEndDate" class="form-input">
      </div>
    </div>
    <button class="stats-report-btn" onclick="generateIntegratedReport()">
      ğŸ“Š í†µí•© ë³´ê³ ì„œ ìƒì„±
    </button>
  </div>
  
  <div class="section">
    <div class="section-title">ğŸ“Š ì „ì²´ í†µê³„</div>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-value" id="statTotalWorks">0</div>
        <div class="stat-label">ì´ ì‘ì—… ê±´ìˆ˜</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">âœ…</div>
        <div class="stat-value" id="statInspections">0</div>
        <div class="stat-label">ê¸°ë³¸ ì ê²€</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">âš¡</div>
        <div class="stat-value" id="statSimple">0</div>
        <div class="stat-label">ê°„ë‹¨ ì ‘ìˆ˜</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸš¨</div>
        <div class="stat-value" id="statMissions">0</div>
        <div class="stat-label">ì¶œë™ ê¸°ë¡</div>
      </div>
    </div>
  </div>
  
  <!-- ë¶€ì„œë³„ í†µê³„ ì°¨íŠ¸ -->
  <div class="section">
    <div class="chart-container">
      <div class="chart-title">ğŸ‘¥ ë¶€ì„œë³„ ì‘ì—… í˜„í™©</div>
      <div class="chart-wrapper">
        <canvas id="deptChart"></canvas>
      </div>
    </div>
  </div>
  
  <!-- ìœ í˜•ë³„ í†µê³„ ì°¨íŠ¸ -->
  <div class="section">
    <div class="chart-container">
      <div class="chart-title">ğŸ“‹ ìœ í˜•ë³„ ì‘ì—… ë¶„í¬</div>
      <div class="chart-wrapper">
        <canvas id="typeChart"></canvas>
      </div>
    </div>
  </div>
  
  <!-- ì²˜ë¦¬í˜„í™© ì°¨íŠ¸ -->
  <div class="section">
    <div class="chart-container">
      <div class="chart-title">â±ï¸ ì²˜ë¦¬ í˜„í™© (ì ‘ìˆ˜/ì™„ë£Œ)</div>
      <div class="chart-wrapper">
        <canvas id="statusChart"></canvas>
      </div>
    </div>
  </div>
  
  <div class="section">
    <div class="section-title">ğŸ“ˆ ìœ í˜•ë³„ í†µê³„</div>
    <div class="category-stats-grid">
      <!-- ì‹œì„¤ í†µê³„ -->
      <div class="category-stat-card facility">
        <div class="category-header">
          <div class="category-name">ğŸ—ï¸ ì‹œì„¤</div>
          <div class="category-icon">ğŸ—ï¸</div>
        </div>
        <div class="category-stats-row">
          <div class="category-stat-item">
            <div class="category-stat-value" id="statFacilityTotal">0</div>
            <div class="category-stat-label">ì „ì²´</div>
          </div>
          <div class="category-stat-item">
            <div class="category-stat-value status-complete" id="statFacilityComplete">0</div>
            <div class="category-stat-label">ì™„ë£Œ</div>
          </div>
          <div class="category-stat-item">
            <div class="category-stat-value status-progress" id="statFacilityProgress">0</div>
            <div class="category-stat-label">ì§„í–‰ì¤‘</div>
          </div>
        </div>
      </div>
      
      <!-- êµí†µ í†µê³„ -->
      <div class="category-stat-card traffic">
        <div class="category-header">
          <div class="category-name">ğŸš¦ êµí†µ</div>
          <div class="category-icon">ğŸš¦</div>
        </div>
        <div class="category-stats-row">
          <div class="category-stat-item">
            <div class="category-stat-value" id="statTrafficTotal">0</div>
            <div class="category-stat-label">ì „ì²´</div>
          </div>
          <div class="category-stat-item">
            <div class="category-stat-value status-complete" id="statTrafficComplete">0</div>
            <div class="category-stat-label">ì™„ë£Œ</div>
          </div>
          <div class="category-stat-item">
            <div class="category-stat-value status-progress" id="statTrafficProgress">0</div>
            <div class="category-stat-label">ì§„í–‰ì¤‘</div>
          </div>
        </div>
      </div>
      
      <!-- ë„ë¡œ í†µê³„ -->
      <div class="category-stat-card road">
        <div class="category-header">
          <div class="category-name">ğŸ›£ï¸ ë„ë¡œ</div>
          <div class="category-icon">ğŸ›£ï¸</div>
        </div>
        <div class="category-stats-row">
          <div class="category-stat-item">
            <div class="category-stat-value" id="statRoadTotal">0</div>
            <div class="category-stat-label">ì „ì²´</div>
          </div>
          <div class="category-stat-item">
            <div class="category-stat-value status-complete" id="statRoadComplete">0</div>
            <div class="category-stat-label">ì™„ë£Œ</div>
          </div>
          <div class="category-stat-item">
            <div class="category-stat-value status-progress" id="statRoadProgress">0</div>
            <div class="category-stat-label">ì§„í–‰ì¤‘</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ëŒ€ê¸°ì—´ í˜ì´ì§€ --><!-- ëŒ€ê¸°ì—´ í˜ì´ì§€ -->
<div id="queue" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goToHome()">â†</button>
    <div class="page-title">ğŸ“¦ ëŒ€ê¸°ì—´ (<span id="queueListCount">0</span>)</div>
  </div>
  
  <div class="queue-list" id="queueListContainer"></div>
</div>

<!-- ì„¤ì • í˜ì´ì§€ -->
<div id="settings" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goToHome()">â†</button>
    <div class="page-title">âš™ï¸ ì„¤ì •</div>
  </div>
  
  <div class="section">
    <div class="settings-item">
      <div class="settings-item-title">ê¸°ë³¸ ì •ë³´</div>
      <div class="form-group">
        <label class="form-label">ë‹´ë‹¹ìëª…</label>
        <input type="text" id="defaultManagerName" class="form-input" value="ê¹€í˜„ì¥">
      </div>
      <div class="form-group">
        <label class="form-label">ì†Œì† ë¶€ì„œ</label>
        <select id="defaultDept" class="form-select">
          <option>ê´€ë¦¬íŒ€</option>
          <option>ì‹œì„¤íŒ€</option>
          <option>ì•ˆì „íŒ€</option>
          <option>ìš´ì˜íŒ€</option>
        </select>
      </div>
    </div>
    
    <div class="settings-item">
      <div class="settings-item-title">ì—…ë¡œë“œ ëª¨ë“œ</div>
      <div class="radio-group">
        <div class="radio-option selected" onclick="selectUploadMode('instant')">
          <input type="radio" name="uploadMode" value="instant" checked>
          <div class="radio-label">
            <div class="radio-title">ì¦‰ì‹œ ì—…ë¡œë“œ</div>
            <div class="radio-desc">ì‘ì—… ë“±ë¡ ì‹œ ë°”ë¡œ ì—…ë¡œë“œ</div>
          </div>
        </div>
        <div class="radio-option" onclick="selectUploadMode('wifi')">
          <input type="radio" name="uploadMode" value="wifi">
          <div class="radio-label">
            <div class="radio-title">WiFi ì—°ê²° ì‹œ ì—…ë¡œë“œ</div>
            <div class="radio-desc">ëŒ€ê¸°ì—´ì— ì €ì¥ í›„ WiFiì—ì„œ ì¼ê´„ ì—…ë¡œë“œ</div>
          </div>
        </div>
      </div>
      <div class="warning-box" id="wifiWarning">
        <div class="warning-text">âš ï¸ WiFi ëª¨ë“œ: ì‘ì—…ì´ ëŒ€ê¸°ì—´ì— ì €ì¥ë˜ë©°, WiFi ì—°ê²° ì‹œ ìˆ˜ë™ìœ¼ë¡œ ì—…ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤.</div>
      </div>
    </div>
    
    <div class="settings-item">
      <div class="settings-item-title">ê´€ë¦¬ì ëª¨ë“œ</div>
      <div class="radio-group">
        <div class="radio-option" onclick="toggleAdminMode(false)">
          <input type="radio" name="adminMode" value="user" checked>
          <div class="radio-label">
            <div class="radio-title">ì¼ë°˜ ì‚¬ìš©ì</div>
            <div class="radio-desc">ê¸°ë³¸ ê¸°ëŠ¥ë§Œ ì‚¬ìš©</div>
          </div>
        </div>
        <div class="radio-option" onclick="toggleAdminMode(true)">
          <input type="radio" name="adminMode" value="admin">
          <div class="radio-label">
            <div class="radio-title">ê´€ë¦¬ì</div>
            <div class="radio-desc">ì‘ì—… ìˆ˜ì •, ì‚­ì œ ë° ì „ì²´ ê·¼íƒœ ì¡°íšŒ ê¶Œí•œ</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="submit">
    <button class="submit-btn" onclick="saveSettings()">ğŸ’¾ ì„¤ì • ì €ì¥</button>
  </div>
</div>

<!-- ì‚¬ì§„ ëª¨ë‹¬ -->
<div id="photoModal" class="modal">
  <div class="modal-content">
    <div class="modal-title">ğŸ“· ì‚¬ì§„ ì¶”ê°€</div>
    <div class="modal-buttons">
      <button class="modal-btn modal-btn-primary" onclick="takePhoto()">ğŸ“¸ ì‚¬ì§„ ì´¬ì˜</button>
      <button class="modal-btn modal-btn-primary" onclick="selectPhoto()">ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬ì—ì„œ ì„ íƒ</button>
      <button class="modal-btn modal-btn-secondary" onclick="closePhotoModal()">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<script>
// ì „ì—­ ìƒíƒœ ê´€ë¦¬
const state = {
  workItems: [],
  queueItems: [],
  missionRecords: [],
  myAttendance: null,
  allAttendance: [],
  currentUser: 'ê¹€í˜„ì¥',
  userDept: 'ê´€ë¦¬íŒ€',
  uploadMode: 'instant',
  isAdmin: false,
  currentMission: null,
  missionTimer: null,
  selectedWorkIndex: null,
  currentFilter: 'all',
  dateFilter: { start: null, end: null },
  isEditMode: false,
  editingWorkIndex: null,
  missionFilterActive: false,
  missionFilterStart: null,
  missionFilterEnd: null,
  currentInspectionTab: 0,
  inspectionChecked: { facility: 0, site: 0, equipment: 0 }
};

let photoCount = 0;
let photoCountSimple = 0;
let currentMode = 'work';
let uploadMode = 'instant';
let userDept = 'ê´€ë¦¬íŒ€';

// ì´ˆê¸°í™”
function init() {
  updateDateTime();
  setInterval(updateDateTime, 60000);
  updatePeriodText();
  loadDummyData();
  updateWorkList();
  updateMissionHistory();
  updateMyAttendance();
  updateQueueBadge();
  
  const deptSelect = document.getElementById('defaultDept');
  if (deptSelect) {
    deptSelect.value = userDept;
  }
}

// ë”ë¯¸ ë°ì´í„° ë¡œë“œ (ìœ í˜• ì¶”ê°€)
// í™•ì¥ëœ ë”ë¯¸ ë°ì´í„° (30ê±´)
function loadDummyData() {
  const now = new Date();
  const today = now.toISOString().split('T')[0];
  
  // ë‚ ì§œ ìƒì„± í•¨ìˆ˜
  const getDateDaysAgo = (days) => {
    const d = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);
    return d.toISOString().split('T')[0];
  };
  
  const departments = ['ë„ë¡œ', 'êµí†µ', 'ì‹œì„¤'];
  const depts = ['ì‹œì„¤íŒ€', 'ì•ˆì „íŒ€', 'ê´€ë¦¬íŒ€', 'ìš´ì˜íŒ€'];
  const workTypes = ['ë„ë¡œ ë³´ìˆ˜', 'ì‹œì„¤ë¬¼ ì ê²€', 'ì²­ì†Œ ì‘ì—…', 'ì œì„¤ ì‘ì—…', 'ê¸´ê¸‰ ë³´ìˆ˜', 'ì •ê¸°ì ê²€'];
  const locations = ['ê°•ë‚¨ëŒ€ë¡œ', 'ì˜¬ë¦¼í”½ëŒ€ë¡œ', 'í…Œí—¤ë€ë¡œ', 'ê°•ë³€ë¶ë¡œ', 'ë‚´ë¶€ìˆœí™˜ë¡œ', 'ì™¸ê³½ìˆœí™˜ë¡œ', 'íœ´ê²Œì†Œ A', 'íœ´ê²Œì†Œ B', 'íœ´ê²Œì†Œ C'];
  const managers = ['ë°•íŒ€ì¥', 'ì´ê³¼ì¥', 'ìµœëŒ€ë¦¬', 'ê¹€í˜„ì¥', 'ì •ì‚¬ì›', 'ê°•ëŒ€ë¦¬', 'ìœ¤ê³¼ì¥'];
  const statuses = ['completed', 'inprogress', 'pending'];
  
  state.workItems = [];
  
  // 30ê±´ì˜ ë‹¤ì–‘í•œ ë°ì´í„° ìƒì„±
  for (let i = 0; i < 30; i++) {
    const daysAgo = Math.floor(i / 3); // 0-10ì¼ ì „
    const date = getDateDaysAgo(daysAgo);
    const category = departments[i % 3];
    const dept = depts[i % 4];
    const manager = managers[i % 7];
    const hour = 8 + (i % 10);
    const startTime = `${String(hour).padStart(2, '0')}:${String((i % 6) * 10).padStart(2, '0')}`;
    const endTime = `${String(hour + 2).padStart(2, '0')}:${String((i % 6) * 10).padStart(2, '0')}`;
    
    if (i % 3 === 0) {
      // ìƒì„¸ì ‘ìˆ˜
      // ìƒì„¸ì ‘ìˆ˜
      const photoCount1 = (i % 3) + 1;
      const photos1 = [];
      for (let j = 0; j < photoCount1; j++) {
        photos1.push(createPhotoWithWatermark(
          locations[i % 9] + ' ' + (100 + i * 5) + 'km',
          date + ' ' + startTime,
          dept
        ));
      }
      state.workItems.push({
        type: 'ìƒì„¸ì ‘ìˆ˜',
        category: category,
        status: statuses[i % 3],
        location: locations[i % 9] + ' ' + (100 + i * 5) + 'km',
        workType: workTypes[i % 6],
        startDate: date,
        startTime: startTime,
        endDate: date,
        endTime: endTime,
        resources: `ì¥ë¹„ ${(i % 3) + 1}ëŒ€`,
        workers: `${(i % 5) + 2}ëª…`,
        detail: `${workTypes[i % 6]} ì‘ì—… - ìƒì„¸ë‚´ìš© ${i + 1}`,
        manager: manager,
        dept: dept,
        photoCount: photoCount1,
        photos: photos1,
        memo: '',
        timestamp: new Date(date + ' ' + startTime).toISOString()
      });
    } else if (i % 3 === 1) {
      // ê¸°ë³¸ì ê²€
      state.workItems.push({
        type: 'ê¸°ë³¸ì ê²€',
        category: category,
        road: locations[i % 9],
        checked: 5 + (i % 4),
        manager: manager,
        dept: dept,
        time: startTime,
        startDate: date,
        photos: [],
        memo: '',
        note: i % 2 === 0 ? 'ì •ìƒ' : 'ë³´ìˆ˜ í•„ìš”',
        timestamp: new Date(date + ' ' + startTime).toISOString()
      });
    } else {
      // ê°„ë‹¨ì ‘ìˆ˜
      // ê°„ë‹¨ì ‘ìˆ˜
      const photoCount2 = (i % 2) + 1;
      const photos2 = [];
      for (let j = 0; j < photoCount2; j++) {
        photos2.push(createPhotoWithWatermark(
          locations[i % 9] + ' ' + (50 + i * 3) + 'km',
          date + ' ' + startTime,
          dept
        ));
      }
      state.workItems.push({
        type: 'ê°„ë‹¨ì ‘ìˆ˜',
        category: category,
        location: locations[i % 9] + ' ' + (50 + i * 3) + 'km',
        manager: manager,
        dept: dept,
        photoCount: photoCount2,
        photos: photos2,
        time: startTime,
        startDate: date,
        memo: '',
        timestamp: new Date(date + ' ' + startTime).toISOString()
      });
    }
  }
  
  // ê¸°ì¡´ ì¶œë™ ê¸°ë¡
  const yesterday = getDateDaysAgo(1);
  const missionStart = new Date(yesterday + ' 15:30').toISOString();
  const missionEnd = new Date(yesterday + ' 17:45').toISOString();
  
  state.missionRecords = [
    {
      date: yesterday,
      startTime: '15:30',
      endTime: '17:45',
      duration: '2ì‹œê°„ 15ë¶„',
      workCount: 0,
      timestamp: missionStart,
      endTimestamp: missionEnd
    }
  ];
  
  calculateMissionWorkCounts();
  
  // ë”ë¯¸ ê·¼íƒœ ë°ì´í„°
  state.allAttendance = [
    {
      employee: 'ë°•íŒ€ì¥',
      date: today,
      startTime: '08:00',
      endTime: null,
      alcoholTest: 'confirmed',
      leaveType: null,
      status: 'working',
      timestamp: new Date(today + ' 08:00').toISOString()
    },
    {
      employee: 'ì´ê³¼ì¥',
      date: today,
      startTime: '08:30',
      endTime: null,
      alcoholTest: 'confirmed',
      leaveType: null,
      status: 'working',
      timestamp: new Date(today + ' 08:30').toISOString()
    },
    {
      employee: 'ìµœëŒ€ë¦¬',
      date: yesterday,
      startTime: '09:00',
      endTime: '18:00',
      alcoholTest: 'confirmed',
      leaveType: null,
      status: 'off',
      duration: '9ì‹œê°„',
      timestamp: new Date(yesterday + ' 09:00').toISOString()
    }
  ];
}


// ì¶œë™ ì‹œê°„ ë™ì•ˆì˜ ì‘ì—… ê±´ìˆ˜ ê³„ì‚°
function calculateMissionWorkCounts() {
  state.missionRecords.forEach(mission => {
    const start = new Date(mission.timestamp).getTime();
    const end = new Date(mission.endTimestamp).getTime();
    
    mission.workCount = state.workItems.filter(item => {
      const itemTime = new Date(item.timestamp).getTime();
      return itemTime >= start && itemTime <= end;
    }).length;
  });
}

// ë‚ ì§œ/ì‹œê°„ ì—…ë°ì´íŠ¸
function updateDateTime() {
  const now = new Date();
  const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')} (${days[now.getDay()]}) ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
  const dateEl = document.getElementById('datetime');
  if (dateEl) dateEl.textContent = dateStr;
}

// ì›Œí„°ë§ˆí¬ê°€ ìˆëŠ” ì‚¬ì§„ ìƒì„±
function createPhotoWithWatermark(location, datetime, dept) {
  const canvas = document.createElement('canvas');
  canvas.width = 800;
  canvas.height = 600;
  const ctx = canvas.getContext('2d');
  
  const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
  gradient.addColorStop(0, '#E3F2FD');
  gradient.addColorStop(1, '#BBDEFB');
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  ctx.strokeStyle = 'rgba(100, 150, 200, 0.1)';
  ctx.lineWidth = 1;
  for (let i = 0; i < canvas.width; i += 40) {
    ctx.beginPath();
    ctx.moveTo(i, 0);
    ctx.lineTo(i, canvas.height);
    ctx.stroke();
  }
  for (let i = 0; i < canvas.height; i += 40) {
    ctx.beginPath();
    ctx.moveTo(0, i);
    ctx.lineTo(canvas.width, i);
    ctx.stroke();
  }
  
  ctx.font = 'bold 120px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillStyle = 'rgba(100, 150, 200, 0.2)';
  ctx.fillText('ğŸ“·', canvas.width / 2, canvas.height / 2 - 40);
  
  ctx.font = 'bold 32px Arial';
  ctx.fillStyle = 'rgba(60, 120, 180, 0.8)';
  ctx.fillText('SAMPLE PHOTO', canvas.width / 2, canvas.height / 2 + 60);
  
  ctx.fillStyle = 'rgba(30, 94, 186, 0.95)';
  ctx.fillRect(0, canvas.height - 140, canvas.width, 140);
  
  ctx.fillStyle = 'white';
  ctx.textAlign = 'left';
  ctx.font = 'bold 28px Arial';
  ctx.fillText(`ğŸ“ ${location}`, 30, canvas.height - 95);
  
  ctx.font = '24px Arial';
  ctx.fillText(`ğŸ• ${datetime}`, 30, canvas.height - 55);
  ctx.fillText(`ğŸ‘¤ ${dept}`, 30, canvas.height - 20);
  
  return canvas.toDataURL('image/jpeg', 0.9);
}

// ëŒ€ê¸°ì—´ ë°°ì§€ ì—…ë°ì´íŠ¸
function updateQueueBadge() {
  const badge = document.getElementById('queueBadge');
  const count = document.getElementById('queueCount');
  if (!badge || !count) return;
  
  const queueCount = state.queueItems.length;
  count.textContent = queueCount;
  
  if (uploadMode === 'wifi' && queueCount > 0) {
    badge.classList.add('show');
    badge.className = queueCount >= 5 ? 'queue-badge show warning' : 'queue-badge show normal';
  } else {
    badge.classList.remove('show');
  }
}

// ëŒ€ê¸°ì—´ ëª©ë¡ ì—…ë°ì´íŠ¸
function updateQueueList() {
  const container = document.getElementById('queueListContainer');
  const countEl = document.getElementById('queueListCount');
  if (!container) return;
  
  if (countEl) countEl.textContent = state.queueItems.length;
  
  if (state.queueItems.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">ğŸ“¦</div>
        <div class="empty-text">ëŒ€ê¸° ì¤‘ì¸ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    `;
    return;
  }
  
  container.innerHTML = state.queueItems.map((item, index) => {
    const typeText = item.type === 'ê¸°ë³¸ì ê²€' ? 'âœ… ê¸°ë³¸ì ê²€' : item.type === 'ê°„ë‹¨ì ‘ìˆ˜' ? 'âš¡ ê°„ë‹¨ì ‘ìˆ˜' : 'ğŸ“ ìƒì„¸ì ‘ìˆ˜';
    return `
      <div class="queue-item">
        <div class="queue-item-header">
          <div class="queue-badge-small">${typeText}</div>
          <div class="queue-time">${item.time || '--:--'}</div>
        </div>
        <div class="queue-info">
          <div class="queue-location">${item.location || item.road || 'ìœ„ì¹˜ ë¯¸ì…ë ¥'}</div>
          ${item.detail ? `<div class="queue-detail">${item.detail}</div>` : ''}
          ${item.checked ? `<div class="queue-detail">ì²´í¬: ${item.checked}/8 í•­ëª©</div>` : ''}
        </div>
        <div class="queue-actions">
          <button class="queue-action-btn queue-upload-btn" onclick="uploadQueueItem(${index})">ğŸ“¤ ì—…ë¡œë“œ</button>
          <button class="queue-action-btn queue-delete-btn" onclick="deleteQueueItem(${index})">ğŸ—‘ï¸ ì‚­ì œ</button>
        </div>
      </div>
    `;
  }).join('');
}

// ëŒ€ê¸°ì—´ ì•„ì´í…œ ì—…ë¡œë“œ
function uploadQueueItem(index) {
  if (index < 0 || index >= state.queueItems.length) return;
  
  const item = state.queueItems.splice(index, 1)[0];
  state.workItems.push(item);
  
  updateQueueList();
  updateQueueBadge();
  updateWorkList();
  
  alert('âœ“ ì‘ì—…ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
}

// ëŒ€ê¸°ì—´ ì•„ì´í…œ ì‚­ì œ
function deleteQueueItem(index) {
  if (!confirm('ì´ ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  state.queueItems.splice(index, 1);
  updateQueueList();
  updateQueueBadge();
  
  alert('âœ“ ì‘ì—…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// ê¸°ê°„ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
function updatePeriodText() {
  const el = document.getElementById('periodText');
  const countEl = document.getElementById('workCount');
  if (!el) return;
  
  const filter = state.currentFilter;
  let filterText = {
    'all': 'ì „ì²´ ì‘ì—…',
    'my': 'ë‚´ ì‘ì—…',
    'mission': 'ì¶œë™ ê¸°ë¡',
    'dailyInspection': 'ì¼ì¼ì ê²€',
    'inspection': 'ê¸°ë³¸ì ê²€',
    'work': 'ì‘ì—… ì ‘ìˆ˜'
  }[filter] || 'ì „ì²´ ì‘ì—…';
  
  if (state.missionFilterActive) {
    filterText = 'ì¶œë™ ì‹œê°„ëŒ€ ì‘ì—…';
  }
  
  el.innerHTML = `${filterText} <span id="workCount">0</span>ê±´`;
}

// ë‚ ì§œ í•„í„° ì ìš©
function applyDateFilter() {
  const startDate = document.getElementById('filterStartDate').value;
  const endDate = document.getElementById('filterEndDate').value;
  
  state.dateFilter = {
    start: startDate || null,
    end: endDate || null
  };
  
  updateWorkList();
}

// ì‘ì—… ëª©ë¡ í•„í„°ë§
function filterWorks(filter) {
  state.currentFilter = filter;
  state.missionFilterActive = false;
  
  const tabs = document.querySelectorAll('.filter-tab');
  tabs.forEach((tab, i) => {
    tab.classList.remove('active');
    if ((filter === 'all' && i === 0) ||
        (filter === 'my' && i === 1) ||
        (filter === 'mission' && i === 2) ||
        (filter === 'inspection' && i === 3) ||
        (filter === 'work' && i === 4)) {
      tab.classList.add('active');
    }
  });
  
  updatePeriodText();
  updateWorkList();
}

// ì¶œë™ ì‹œê°„ëŒ€ ì‘ì—… í•„í„°ë§
function filterWorksByMission(startTimestamp, endTimestamp) {
  state.missionFilterActive = true;
  state.missionFilterStart = startTimestamp;
  state.missionFilterEnd = endTimestamp;
  state.currentFilter = 'mission-time';
  
  const tabs = document.querySelectorAll('.filter-tab');
  tabs.forEach(tab => tab.classList.remove('active'));
  
  updatePeriodText();
  updateWorkList();
  
  setActivePage('list');
  window.scrollTo(0, 0);
}

// ì‘ì—… ëª©ë¡ ì—…ë°ì´íŠ¸
function updateWorkList() {
  const container = document.getElementById('workListContainer');
  if (!container) return;
  
  let items = [...state.workItems];
  
  if (state.missionFilterActive && state.missionFilterStart && state.missionFilterEnd) {
    const start = new Date(state.missionFilterStart).getTime();
    const end = new Date(state.missionFilterEnd).getTime();
    
    items = items.filter(item => {
      const itemTime = new Date(item.timestamp).getTime();
      return itemTime >= start && itemTime <= end;
    });
  } else {
    if (state.currentFilter === 'my') {
      items = items.filter(item => item.manager === state.currentUser);
    } else if (state.currentFilter === 'mission') {
      items = state.missionRecords.map(d => ({
        type: 'mission',
        date: d.date,
        startTime: d.startTime,
        endTime: d.endTime,
        duration: d.duration,
        workCount: d.workCount || 0,
        timestamp: d.timestamp,
        endTimestamp: d.endTimestamp
      }));
    } else if (state.currentFilter === 'dailyInspection') {
      items = items.filter(item => item.type === 'ì¼ì¼ì ê²€');
    } else if (state.currentFilter === 'inspection') {
      items = items.filter(item => item.type === 'ê¸°ë³¸ì ê²€');
    } else if (state.currentFilter === 'work') {
      items = items.filter(item => item.type === 'ìƒì„¸ì ‘ìˆ˜' || item.type === 'ê°„ë‹¨ì ‘ìˆ˜');
    }
    
    if (state.currentFilter === 'all' || state.currentFilter === 'my') {
      const missionItems = state.missionRecords.map(d => ({
        type: 'mission',
        date: d.date,
        startTime: d.startTime,
        endTime: d.endTime,
        duration: d.duration,
        workCount: d.workCount || 0,
        timestamp: d.timestamp,
        endTimestamp: d.endTimestamp
      }));
      items = [...items, ...missionItems];
    }
  }
  
  if (state.dateFilter.start || state.dateFilter.end) {
    items = items.filter(item => {
      const itemDate = item.startDate || item.date;
      if (!itemDate) return false;
      
      if (state.dateFilter.start && itemDate < state.dateFilter.start) return false;
      if (state.dateFilter.end && itemDate > state.dateFilter.end) return false;
      
      return true;
    });
  }
  
  items.sort((a, b) => {
    const timeA = new Date(a.timestamp || a.startDate).getTime();
    const timeB = new Date(b.timestamp || b.startDate).getTime();
    return timeB - timeA;
  });
  
  const countEl = document.getElementById('workCount');
  if (countEl) countEl.textContent = items.length;
  
  if (items.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">ğŸ“‹</div>
        <div class="empty-text">ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    `;
    return;
  }
  
  container.innerHTML = items.map((item, index) => {
    if (item.type === 'mission') {
      return `
        <div class="work-item mission" onclick="filterWorksByMission('${item.timestamp}', '${item.endTimestamp}')">
          <div class="work-item-header">
            <div class="work-badge mission">ğŸš¨ ì¶œë™</div>
            <div class="work-time">${item.date}</div>
          </div>
          <div class="work-info">
            <div class="work-location">${item.duration}</div>
            <div class="history-times">
              <div class="history-time-item">ğŸš¨ ${item.startTime}</div>
              <div class="history-time-item">ğŸ  ${item.endTime || 'ì§„í–‰ì¤‘'}</div>
            </div>
            ${item.workCount > 0 ? `<div class="history-work-count">ğŸ“ ì‘ì—… ${item.workCount}ê±´ ì™„ë£Œ (í´ë¦­í•˜ì—¬ ë³´ê¸°)</div>` : ''}
          </div>
        </div>
      `;
    }
    
    const originalIndex = state.workItems.indexOf(item);
    
    let photoPreview = '';
    if (item.photos && item.photos.length > 0) {
      const displayPhotos = item.photos.slice(0, 3);
      photoPreview = `
        <div class="work-photos-preview">
          ${displayPhotos.map(photo => `
            <div class="work-photo-thumb">
              <img src="${photo}" alt="ì‚¬ì§„">
            </div>
          `).join('')}
          ${item.photos.length > 3 ? `<div style="font-size: 12px; color: #999; padding: 4px;">+${item.photos.length - 3}ì¥ ë”ë³´ê¸°</div>` : ''}
        </div>
      `;
    }
    
    if (item.type === 'ì¼ì¼ì ê²€') {
      const inspectionIcon = item.inspectionType === 'ì‹œì„¤ì ê²€' ? 'ğŸ—ï¸' : item.inspectionType === 'í˜„ì¥ì ê²€' ? 'ğŸš§' : 'ğŸ”§';
      return `
        <div class="work-item daily-inspection" onclick="showDailyInspectionReport(${originalIndex})">
          <div class="work-item-header">
            <div class="work-badge daily-inspection">ğŸ“‹ ${item.inspectionType}</div>
            <div class="work-time">${item.time || '--:--'}</div>
          </div>
          <div class="work-info">
            <div class="work-location">${inspectionIcon} ì¼ì¼ì ê²€ì¼ì§€</div>
            <div class="work-detail">ì²´í¬ ì™„ë£Œ: ${item.checked} í•­ëª©</div>
            ${item.note ? `<div class="work-detail">${item.note}</div>` : ''}
            <div class="work-meta">
              <span>ğŸ‘¤ ${item.manager}</span>
              <span>ğŸ“… ${item.startDate}</span>
              <span style="color: #9C27B0; font-weight: 700;">ğŸ“„ ë³´ê³ ì„œ ì¶œë ¥</span>
            </div>
          </div>
        </div>
      `;
    }
    
    if (item.type === 'ê¸°ë³¸ì ê²€') {
      return `
        <div class="work-item inspection" onclick="editWorkFromList(${originalIndex})">
          <div class="work-item-header">
            <div class="work-badge inspection">âœ… ê¸°ë³¸ì ê²€</div>
            <div class="work-time">${item.time || '--:--'}</div>
          </div>
          <div class="work-info">
            <div class="work-location">${item.road}</div>
            <div class="work-detail">ì²´í¬: ${item.checked}/8 í•­ëª©</div>
            ${item.note ? `<div class="work-detail">${item.note}</div>` : ''}
            <div class="work-meta">
              <span>ğŸ‘¤ ${item.manager}</span>
              <span>ğŸ“… ${item.startDate}</span>
            </div>
          </div>
        </div>
      `;
    }
    
    if (item.type === 'ê°„ë‹¨ì ‘ìˆ˜') {
      const categoryIcon = item.category === 'ì‹œì„¤' ? 'ğŸ—ï¸' : item.category === 'êµí†µ' ? 'ğŸš¦' : item.category === 'ë„ë¡œ' ? 'ğŸ›£ï¸' : '';
      return `
        <div class="work-item work" onclick="editWorkFromList(${originalIndex})">
          <div class="work-item-header">
            <div class="work-badge work">âš¡ ê°„ë‹¨ì ‘ìˆ˜</div>
            <div class="work-time">${item.time || '--:--'}</div>
          </div>
          <div class="work-info">
            <div class="work-location">${categoryIcon} ${item.location}</div>
            <div class="work-detail">ğŸ“· ì‚¬ì§„ ${item.photoCount}ì¥</div>
            ${photoPreview}
            <div class="work-meta">
              <span>ğŸ‘¤ ${item.manager}</span>
              <span>ğŸ“… ${item.startDate}</span>
              <span style="color: #2196F3; font-weight: 700; cursor: pointer;" onclick="event.stopPropagation(); showWorkReport(${originalIndex})">ğŸ“„ ë³´ê³ ì„œ ì¶œë ¥</span>
            </div>
          </div>
        </div>
      `;
    }
    
    if (item.type === 'ìƒì„¸ì ‘ìˆ˜') {
      const statusText = item.status === 'completed' ? 'ì™„ë£Œ' : item.status === 'inprogress' ? 'ì§„í–‰ì¤‘' : 'ì˜ˆì •';
      const categoryIcon = item.category === 'ì‹œì„¤' ? 'ğŸ—ï¸' : item.category === 'êµí†µ' ? 'ğŸš¦' : item.category === 'ë„ë¡œ' ? 'ğŸ›£ï¸' : '';
      return `
        <div class="work-item work" onclick="editWorkFromList(${originalIndex})">
          <div class="work-item-header">
            <div class="work-badge work">ğŸ“ ìƒì„¸ì ‘ìˆ˜</div>
            <div class="work-time">${statusText}</div>
          </div>
          <div class="work-info">
            <div class="work-location">${categoryIcon} ${item.location}</div>
            <div class="work-detail">${item.workType}</div>
            ${item.detail ? `<div class="work-detail">${item.detail}</div>` : ''}
            ${photoPreview}
            <div class="work-meta">
              <span>ğŸ‘¤ ${item.manager}</span>
              ${item.startDate ? `<span>ğŸ“… ${item.startDate}</span>` : ''}
              <span style="color: #2196F3; font-weight: 700; cursor: pointer;" onclick="event.stopPropagation(); showWorkReport(${originalIndex})">ğŸ“„ ë³´ê³ ì„œ ì¶œë ¥</span>
            </div>
          </div>
        </div>
      `;
    }
    
    return '';
  }).join('');
  
  updateStats();
}

// ì‘ì—… ëª©ë¡ì—ì„œ ìˆ˜ì • ëª¨ë“œë¡œ ì§„ì…
function editWorkFromList(index) {
  if (index < 0 || index >= state.workItems.length) return;
  
  const item = state.workItems[index];
  const canEdit = state.isAdmin || item.manager === state.currentUser;
  
  if (item.type === 'ìƒì„¸ì ‘ìˆ˜') {
    state.isEditMode = true;
    state.editingWorkIndex = index;
    
    document.getElementById('workStatus').value = item.status || 'pending';
    document.getElementById('workCategory').value = item.category || '';
    document.getElementById('locationInput').value = item.location || '';
    document.getElementById('workType').value = item.workType || 'ì„ íƒí•´ì£¼ì„¸ìš”';
    document.getElementById('startDate').value = item.startDate || '';
    document.getElementById('startTime').value = item.startTime || '';
    document.getElementById('endDate').value = item.endDate || '';
    document.getElementById('endTime').value = item.endTime || '';
    document.getElementById('workResources').value = item.resources || '';
    document.getElementById('workers').value = item.workers || '';
    document.getElementById('workDetail').value = item.detail || '';
    document.getElementById('managerName').value = item.manager || '';
    
    photoCount = item.photoCount || 0;
    document.getElementById('num').textContent = photoCount;
    
    const picsContainer = document.getElementById('pics');
    picsContainer.innerHTML = '';
    
    if (item.photos && item.photos.length > 0) {
      item.photos.forEach(photo => {
        const photoDiv = document.createElement('div');
        photoDiv.className = 'photo';
        photoDiv.innerHTML = `<img src="${photo}">`;
        if (canEdit) {
          photoDiv.innerHTML += `<button class="photo-remove" onclick="delPhoto(this)">Ã—</button>`;
        }
        picsContainer.appendChild(photoDiv);
      });
    }
    
    if (canEdit && photoCount < 5) {
      const addBtn = document.createElement('div');
      addBtn.className = 'add-photo-btn';
      addBtn.onclick = showPhotoModal;
      addBtn.innerHTML = '<div class="add-photo-icon">ğŸ“·</div><div class="add-photo-text">ì¶”ê°€</div>';
      picsContainer.appendChild(addBtn);
    }
    
    if (!canEdit) {
      document.getElementById('workStatus').disabled = true;
      document.getElementById('workCategory').disabled = true;
      document.getElementById('locationInput').disabled = true;
      document.getElementById('workType').disabled = true;
      document.getElementById('startDate').disabled = true;
      document.getElementById('startTime').disabled = true;
      document.getElementById('endDate').disabled = true;
      document.getElementById('endTime').disabled = true;
      document.getElementById('workResources').disabled = true;
      document.getElementById('workers').disabled = true;
      document.getElementById('workDetail').disabled = true;
      document.getElementById('managerName').disabled = true;
    }
    
    document.getElementById('workPageTitle').textContent = canEdit ? 'ğŸ“ ì‘ì—… ìˆ˜ì •' : 'ğŸ“ ì‘ì—… ìƒì„¸';
    document.getElementById('editModeIndicator').style.display = canEdit ? 'block' : 'none';
    document.getElementById('workSubmitBtn').textContent = canEdit ? 'ğŸ’¾ ìˆ˜ì • ì €ì¥' : 'ë‹«ê¸°';
    document.getElementById('workSubmitBtn').disabled = !canEdit;
    
    setActivePage('work');
    window.scrollTo(0, 0);
  } else if (item.type === 'ê¸°ë³¸ì ê²€' || item.type === 'ê°„ë‹¨ì ‘ìˆ˜') {
    showWorkDetailModal(index, canEdit);
  }
}

// ê°„ë‹¨í•œ ì‘ì—… ìƒì„¸ ëª¨ë‹¬
function showWorkDetailModal(index, canEdit) {
  const item = state.workItems[index];
  let content = '';
  
  if (item.type === 'ê¸°ë³¸ì ê²€') {
    content = `
      <div class="form-group">
        <label class="form-label">ì ê²€ ë„ë¡œ</label>
        <input type="text" id="modalRoad" class="form-input" value="${item.road || ''}" ${canEdit ? '' : 'disabled'}>
      </div>
      <div class="form-group">
        <label class="form-label">ì²´í¬ í•­ëª©</label>
        <input type="number" id="modalChecked" class="form-input" value="${item.checked || 0}" ${canEdit ? '' : 'disabled'}>
      </div>
      <div class="form-group">
        <label class="form-label">íŠ¹ì´ì‚¬í•­</label>
        <textarea id="modalNote" class="form-textarea" ${canEdit ? '' : 'disabled'}>${item.note || ''}</textarea>
      </div>
      <div class="form-group">
        <label class="form-label">ì ê²€ì</label>
        <input type="text" class="form-input" value="${item.manager} (${item.dept})" disabled>
      </div>
      <div class="form-group">
        <label class="form-label">ì ê²€ ì‹œê°</label>
        <input type="text" class="form-input" value="${item.startDate} ${item.time}" disabled>
      </div>
    `;
  } else if (item.type === 'ê°„ë‹¨ì ‘ìˆ˜') {
    const photosHtml = item.photos && item.photos.length > 0 ? `
      <div class="form-group">
        <label class="form-label">í˜„ì¥ ì‚¬ì§„ (${item.photoCount}ì¥)</label>
        <div class="detail-photos">
          ${item.photos.map(photo => `
            <div class="detail-photo" onclick="showPhotoFullscreen('${photo}')">
              <img src="${photo}" alt="ì‚¬ì§„">
            </div>
          `).join('')}
        </div>
      </div>
    ` : '';
    
    content = `
      <div class="form-group">
        <label class="form-label">ì‘ì—… êµ¬ë¶„</label>
        <input type="text" class="form-input" value="${item.category || 'ë¯¸ì§€ì •'}" disabled>
      </div>
      <div class="form-group">
        <label class="form-label">ì‘ì—… ìœ„ì¹˜</label>
        <input type="text" id="modalLocation" class="form-input" value="${item.location || ''}" ${canEdit ? '' : 'disabled'}>
      </div>
      ${photosHtml}
      <div class="form-group">
        <label class="form-label">ë‹´ë‹¹ì</label>
        <input type="text" class="form-input" value="${item.manager} (${item.dept})" disabled>
      </div>
      <div class="form-group">
        <label class="form-label">ë“±ë¡ ì‹œê°</label>
        <input type="text" class="form-input" value="${item.startDate} ${item.time}" disabled>
      </div>
    `;
  }
  
  const modalHtml = `
    <div id="detailModal" class="modal" style="display: flex;">
      <div class="modal-content-large">
        <div class="modal-header">
          <div class="modal-title">${canEdit ? 'ì‘ì—… ìˆ˜ì •' : 'ì‘ì—… ìƒì„¸'}</div>
          <button class="modal-close" onclick="closeDetailModal()">Ã—</button>
        </div>
        <div class="modal-body">
          ${content}
        </div>
        <div class="modal-footer">
          ${canEdit ? `<button class="modal-btn modal-btn-primary" onclick="saveSimpleWorkEdit(${index})">ğŸ’¾ ì €ì¥</button>` : ''}
          ${state.isAdmin ? `<button class="modal-btn modal-btn-secondary" onclick="deleteWorkFromModal(${index})">ğŸ—‘ï¸ ì‚­ì œ</button>` : ''}
          <button class="modal-btn modal-btn-secondary" onclick="closeDetailModal()">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', modalHtml);
}

function closeDetailModal() {
  const modal = document.getElementById('detailModal');
  if (modal) modal.remove();
}

function saveSimpleWorkEdit(index) {
  const item = state.workItems[index];
  
  if (item.type === 'ê¸°ë³¸ì ê²€') {
    item.road = document.getElementById('modalRoad').value;
    item.checked = parseInt(document.getElementById('modalChecked').value);
    item.note = document.getElementById('modalNote').value;
  } else if (item.type === 'ê°„ë‹¨ì ‘ìˆ˜') {
    item.location = document.getElementById('modalLocation').value;
  }
  
  closeDetailModal();
  updateWorkList();
  alert('âœ“ ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
}

function deleteWorkFromModal(index) {
  if (!confirm('ì´ ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  state.workItems.splice(index, 1);
  closeDetailModal();
  updateWorkList();
  calculateMissionWorkCounts();
  alert('âœ“ ì‘ì—…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function showPhotoFullscreen(photoSrc) {
  const modal = document.createElement('div');
  modal.className = 'modal';
  modal.style.display = 'flex';
  modal.innerHTML = `
    <div class="modal-content-large" style="max-width: 90%; max-height: 90%;">
      <div class="modal-header">
        <div class="modal-title">ì‚¬ì§„ ë³´ê¸°</div>
        <button class="modal-close" onclick="this.closest('.modal').remove()">Ã—</button>
      </div>
      <div class="modal-body" style="padding: 0;">
        <img src="${photoSrc}" style="width: 100%; height: auto;">
      </div>
    </div>
  `;
  modal.onclick = (e) => {
    if (e.target === modal) modal.remove();
  };
  document.body.appendChild(modal);
}

// ì‘ì—… ìˆ˜ì • ì·¨ì†Œ
function cancelWorkEdit() {
  if (state.isEditMode) {
    if (confirm('ìˆ˜ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      state.isEditMode = false;
      state.editingWorkIndex = null;
      resetWorkForm();
      goToList();
    }
  } else {
    goToHome();
  }
}

function resetWorkForm() {
  document.getElementById('workStatus').value = 'pending';
  document.getElementById('workStatus').disabled = false;
  document.getElementById('workCategory').value = '';
  document.getElementById('workCategory').disabled = false;
  document.getElementById('locationInput').value = '';
  document.getElementById('locationInput').disabled = false;
  document.getElementById('workType').value = 'ì„ íƒí•´ì£¼ì„¸ìš”';
  document.getElementById('workType').disabled = false;
  document.getElementById('startDate').value = '';
  document.getElementById('startDate').disabled = false;
  document.getElementById('startTime').value = '';
  document.getElementById('startTime').disabled = false;
  document.getElementById('endDate').value = '';
  document.getElementById('endDate').disabled = false;
  document.getElementById('endTime').value = '';
  document.getElementById('endTime').disabled = false;
  document.getElementById('workResources').value = '';
  document.getElementById('workResources').disabled = false;
  document.getElementById('workers').value = '';
  document.getElementById('workers').disabled = false;
  document.getElementById('workDetail').value = '';
  document.getElementById('workDetail').disabled = false;
  document.getElementById('managerName').value = state.currentUser;
  document.getElementById('managerName').disabled = false;
  
  photoCount = 0;
  document.getElementById('num').textContent = '0';
  document.getElementById('pics').innerHTML = '<div class="add-photo-btn" onclick="showPhotoModal()"><div class="add-photo-icon">ğŸ“·</div><div class="add-photo-text">ì¶”ê°€</div></div>';
  
  document.getElementById('workPageTitle').textContent = 'ğŸ“ ìƒì„¸ ì‘ì—… ì ‘ìˆ˜';
  document.getElementById('editModeIndicator').style.display = 'none';
  document.getElementById('workSubmitBtn').textContent = 'ğŸ“ ì‘ì—… ë“±ë¡';
  document.getElementById('workSubmitBtn').disabled = false;
}

// í†µê³„ ì—…ë°ì´íŠ¸ (ìœ í˜•ë³„ í†µê³„ ì¶”ê°€)
function updateStats() {
  const totalEl = document.getElementById('statTotalWorks');
  const inspectionEl = document.getElementById('statInspections');
  const simpleEl = document.getElementById('statSimple');
  const missionsEl = document.getElementById('statMissions');
  
  if (totalEl) totalEl.textContent = state.workItems.length;
  if (inspectionEl) {
    const inspections = state.workItems.filter(item => item.type === 'ê¸°ë³¸ì ê²€').length;
    inspectionEl.textContent = inspections;
  }
  if (simpleEl) {
    const simple = state.workItems.filter(item => item.type === 'ê°„ë‹¨ì ‘ìˆ˜').length;
    simpleEl.textContent = simple;
  }
  if (missionsEl) missionsEl.textContent = state.missionRecords.length;
  
  // ìœ í˜•ë³„ í†µê³„ ì—…ë°ì´íŠ¸
  updateCategoryStats();
  
  // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
  updateAllCharts();
}

// ìœ í˜•ë³„ í†µê³„ ì—…ë°ì´íŠ¸
function updateCategoryStats() {
  const categories = ['ì‹œì„¤', 'êµí†µ', 'ë„ë¡œ'];
  
  categories.forEach(category => {
    const items = state.workItems.filter(item => 
      item.category === category && (item.type === 'ìƒì„¸ì ‘ìˆ˜' || item.type === 'ê°„ë‹¨ì ‘ìˆ˜')
    );
    
    const total = items.length;
    const completed = items.filter(item => item.status === 'completed').length;
    const inprogress = items.filter(item => item.status === 'inprogress' || item.status === 'pending' || !item.status).length;
    
    const categoryName = category === 'ì‹œì„¤' ? 'Facility' : category === 'êµí†µ' ? 'Traffic' : 'Road';
    
    const totalEl = document.getElementById(`stat${categoryName}Total`);
    const completeEl = document.getElementById(`stat${categoryName}Complete`);
    const progressEl = document.getElementById(`stat${categoryName}Progress`);
    
    if (totalEl) totalEl.textContent = total;
    if (completeEl) completeEl.textContent = completed;
    if (progressEl) progressEl.textContent = inprogress;
  });
}

// ì°¨íŠ¸ ì „ì—­ ë³€ìˆ˜
let deptChart = null;
let typeChart = null;
let statusChart = null;
let currentStatsPeriod = 'daily'; // daily, weekly, monthly

// ê¸°ê°„ í•„í„°
function filterStatsPeriod(period) {
  currentStatsPeriod = period;
  
  // íƒ­ í™œì„±í™”
  document.querySelectorAll('.stats-filter-tab').forEach((tab, idx) => {
    tab.classList.remove('active');
    if ((period === 'daily' && idx === 0) ||
        (period === 'weekly' && idx === 1) ||
        (period === 'monthly' && idx === 2)) {
      tab.classList.add('active');
    }
  });
  
  // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
  updateAllCharts();
}

// ê¸°ê°„ë³„ ë°ì´í„° í•„í„°ë§
function getFilteredDataByPeriod() {
  const now = new Date();
  let startDate;
  
  if (currentStatsPeriod === 'daily') {
    // ì˜¤ëŠ˜
    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  } else if (currentStatsPeriod === 'weekly') {
    // ìµœê·¼ 7ì¼
    startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
  } else {
    // ìµœê·¼ 30ì¼
    startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
  }
  
  return state.workItems.filter(item => {
    const itemDate = new Date(item.timestamp);
    return itemDate >= startDate;
  });
}

// ë¶€ì„œë³„ ì°¨íŠ¸ ë Œë”ë§
function renderDeptChart() {
  const filteredData = getFilteredDataByPeriod();
  const depts = {};
  
  filteredData.forEach(item => {
    if (item.dept) {
      depts[item.dept] = (depts[item.dept] || 0) + 1;
    }
  });
  
  const labels = Object.keys(depts);
  const data = Object.values(depts);
  const colors = ['#FF9800', '#4CAF50', '#2196F3', '#9C27B0'];
  
  const ctx = document.getElementById('deptChart');
  if (!ctx) return;
  
  if (deptChart) {
    deptChart.destroy();
  }
  
  deptChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'ì‘ì—… ê±´ìˆ˜',
        data: data,
        backgroundColor: colors.slice(0, labels.length),
        borderColor: colors.slice(0, labels.length).map(c => c.replace('0.8', '1')),
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        title: {
          display: false
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1
          }
        }
      }
    }
  });
}

// ìœ í˜•ë³„ ì°¨íŠ¸ ë Œë”ë§
function renderTypeChart() {
  const filteredData = getFilteredDataByPeriod();
  const categories = {};
  
  filteredData.forEach(item => {
    if (item.category) {
      categories[item.category] = (categories[item.category] || 0) + 1;
    }
  });
  
  const labels = Object.keys(categories);
  const data = Object.values(categories);
  const colors = ['#2196F3', '#FF9800', '#4CAF50'];
  
  const ctx = document.getElementById('typeChart');
  if (!ctx) return;
  
  if (typeChart) {
    typeChart.destroy();
  }
  
  typeChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: labels.map(l => l === 'ë„ë¡œ' ? 'ğŸ›£ï¸ ë„ë¡œ' : l === 'êµí†µ' ? 'ğŸš¦ êµí†µ' : 'ğŸ—ï¸ ì‹œì„¤'),
      datasets: [{
        data: data,
        backgroundColor: colors.slice(0, labels.length),
        borderWidth: 2,
        borderColor: '#fff'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            padding: 15,
            font: {
              size: 13
            }
          }
        }
      }
    }
  });
}

// ì²˜ë¦¬í˜„í™© ì°¨íŠ¸ ë Œë”ë§
function renderStatusChart() {
  const filteredData = getFilteredDataByPeriod();
  
  // ì¼ë³„ ë°ì´í„° ì§‘ê³„
  const dateMap = {};
  
  filteredData.forEach(item => {
    const date = item.startDate || item.timestamp.split('T')[0];
    if (!dateMap[date]) {
      dateMap[date] = { total: 0, completed: 0 };
    }
    dateMap[date].total++;
    if (item.status === 'completed') {
      dateMap[date].completed++;
    }
  });
  
  // ë‚ ì§œ ì •ë ¬
  const dates = Object.keys(dateMap).sort();
  const labels = dates.map(d => {
    const parts = d.split('-');
    return `${parts[1]}/${parts[2]}`;
  });
  
  const totalData = dates.map(d => dateMap[d].total);
  const completedData = dates.map(d => dateMap[d].completed);
  
  const ctx = document.getElementById('statusChart');
  if (!ctx) return;
  
  if (statusChart) {
    statusChart.destroy();
  }
  
  statusChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'ì ‘ìˆ˜',
          data: totalData,
          borderColor: '#2196F3',
          backgroundColor: 'rgba(33, 150, 243, 0.1)',
          borderWidth: 3,
          tension: 0.3,
          fill: true
        },
        {
          label: 'ì™„ë£Œ',
          data: completedData,
          borderColor: '#4CAF50',
          backgroundColor: 'rgba(76, 175, 80, 0.1)',
          borderWidth: 3,
          tension: 0.3,
          fill: true
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top',
          labels: {
            padding: 15,
            font: {
              size: 13
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1
          }
        }
      }
    }
  });
}

// ëª¨ë“  ì°¨íŠ¸ ì—…ë°ì´íŠ¸
function updateAllCharts() {
  renderDeptChart();
  renderTypeChart();
  renderStatusChart();
}


// ì¶œë™/ë³µê·€ ê¸°ëŠ¥
function toggleMission() {
  if (!state.currentMission) {
    const now = new Date();
    state.currentMission = {
      date: `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`,
      startTime: `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`,
      startTimestamp: now.getTime(),
      workCount: 0
    };
    
    const btn = document.getElementById('missionBtn');
    if (btn) {
      btn.textContent = 'ğŸ  ë³µê·€í•˜ê¸°';
      btn.classList.remove('start');
      btn.classList.add('end');
    }
    
    const info = document.getElementById('missionInfo');
    if (info) {
      info.classList.add('show');
      document.getElementById('missionStartTime').textContent = state.currentMission.startTime;
    }
    
    startMissionTimer();
    alert('âœ“ ì¶œë™ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
    
  } else {
    const now = new Date();
    state.currentMission.endTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
    state.currentMission.endTimestamp = now.getTime();
    
    const duration = Math.floor((state.currentMission.endTimestamp - state.currentMission.startTimestamp) / 1000 / 60 / 60 * 10) / 10;
    state.currentMission.duration = `${Math.floor(duration)}ì‹œê°„ ${Math.round((duration % 1) * 60)}ë¶„`;
    state.currentMission.timestamp = new Date(state.currentMission.startTimestamp).toISOString();
    
    const worksDuringMission = state.workItems.filter(item => {
      const itemTime = new Date(item.timestamp).getTime();
      return itemTime >= state.currentMission.startTimestamp && itemTime <= state.currentMission.endTimestamp;
    });
    state.currentMission.workCount = worksDuringMission.length;
    
    state.missionRecords.push({...state.currentMission});
    state.currentMission = null;
    
    stopMissionTimer();
    
    const btn = document.getElementById('missionBtn');
    if (btn) {
      btn.textContent = 'ğŸš¨ ì¶œë™í•˜ê¸°';
      btn.classList.remove('end');
      btn.classList.add('start');
    }
    
    const info = document.getElementById('missionInfo');
    if (info) info.classList.remove('show');
    
    const timer = document.getElementById('missionTimer');
    if (timer) timer.textContent = '00:00:00';
    
    updateMissionHistory();
    alert('âœ“ ë³µê·€ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
  }
}

function startMissionTimer() {
  updateMissionTime();
  state.missionTimer = setInterval(updateMissionTime, 1000);
}

function stopMissionTimer() {
  if (state.missionTimer) {
    clearInterval(state.missionTimer);
    state.missionTimer = null;
  }
}

function updateMissionTime() {
  if (!state.currentMission) return;
  
  const now = Date.now();
  const elapsed = Math.floor((now - state.currentMission.startTimestamp) / 1000);
  
  const hours = Math.floor(elapsed / 3600);
  const minutes = Math.floor((elapsed % 3600) / 60);
  const seconds = elapsed % 60;
  
  const timer = document.getElementById('missionTimer');
  if (timer) {
    timer.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
  }
  
  const duration = document.getElementById('missionDuration');
  if (duration) {
    duration.textContent = `${hours}ì‹œê°„ ${minutes}ë¶„`;
  }
}

function updateMissionHistory() {
  const container = document.getElementById('missionHistory');
  if (!container) return;
  
  if (state.missionRecords.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">ğŸš¨</div>
        <div class="empty-text">ì¶œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    `;
    return;
  }
  
  container.innerHTML = state.missionRecords.map(record => `
    <div class="history-item" onclick="filterWorksByMission('${record.timestamp}', '${new Date(record.endTimestamp).toISOString()}')">
      <div class="history-header">
        <div class="history-date">${record.date}</div>
        <div class="history-duration">${record.duration}</div>
      </div>
      <div class="history-times">
        <div class="history-time-item">ğŸš¨ ${record.startTime}</div>
        <div class="history-time-item">ğŸ  ${record.endTime}</div>
      </div>
      ${record.workCount > 0 ? `<div class="history-work-count">ğŸ“ ì‘ì—… ${record.workCount}ê±´ ì™„ë£Œ (í´ë¦­í•˜ì—¬ ë³´ê¸°)</div>` : ''}
    </div>
  `).join('');
}

// ê·¼íƒœê´€ë¦¬ - ë³¸ì¸ ê·¼íƒœ ì—…ë°ì´íŠ¸
function updateMyAttendance() {
  const userNameEl = document.getElementById('attendanceUserName');
  const checkInEl = document.getElementById('myCheckInTime');
  const checkOutEl = document.getElementById('myCheckOutTime');
  const alcoholEl = document.getElementById('myAlcoholStatus');
  
  if (userNameEl) userNameEl.textContent = state.currentUser;
  
  const today = new Date().toISOString().split('T')[0].replace(/-/g, '.');
  
  const myRecord = state.allAttendance.find(r => 
    r.employee === state.currentUser && r.date === today
  );
  
  if (myRecord) {
    state.myAttendance = myRecord;
    if (checkInEl) checkInEl.textContent = myRecord.startTime;
    if (checkOutEl) checkOutEl.textContent = myRecord.endTime || 'ë¯¸ë“±ë¡';
    
    if (alcoholEl) {
      const statusClass = myRecord.alcoholTest === 'confirmed' ? 'confirmed' : 'detected';
      const statusText = myRecord.alcoholTest === 'confirmed' ? 'âœ“ í™•ì¸ì™„ë£Œ' : 'âœ— ì ë°œ';
      alcoholEl.innerHTML = `<div class="alcohol-status ${statusClass}">${statusText}</div>`;
    }
  } else {
    state.myAttendance = null;
    if (checkInEl) checkInEl.textContent = 'ë¯¸ë“±ë¡';
    if (checkOutEl) checkOutEl.textContent = 'ë¯¸ë“±ë¡';
    if (alcoholEl) alcoholEl.innerHTML = '';
  }
  
  if (state.isAdmin) {
    document.getElementById('adminAttendanceSection').style.display = 'block';
    updateAllAttendanceList();
  } else {
    document.getElementById('adminAttendanceSection').style.display = 'none';
  }
}

// ì „ì²´ ê·¼íƒœ ëª©ë¡ (ê´€ë¦¬ì)
function updateAllAttendanceList() {
  const container = document.getElementById('allAttendanceList');
  if (!container) return;
  
  if (state.allAttendance.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">â°</div>
        <div class="empty-text">ê·¼íƒœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    `;
    return;
  }
  
  container.innerHTML = state.allAttendance.map((record, index) => `
    <div class="attendance-item">
      <div class="attendance-header">
        <div class="attendance-name">
          ${record.employee}
          <span class="alcohol-badge ${record.alcoholTest}">${record.alcoholTest === 'confirmed' ? 'âœ“ í™•ì¸ì™„ë£Œ' : 'âœ— ì ë°œ'}</span>
          ${record.leaveType ? `<span class="leave-badge">${record.leaveType}</span>` : ''}
        </div>
        <div class="attendance-status ${record.status}">
          ${record.status === 'working' ? 'ê·¼ë¬´ì¤‘' : 'í‡´ê·¼'}
        </div>
      </div>
      <div class="attendance-times">
        <div class="history-time-item">ğŸ¢ ì¶œê·¼: ${record.startTime}</div>
        ${record.endTime ? `<div class="history-time-item">ğŸ  í‡´ê·¼: ${record.endTime}</div>` : ''}
      </div>
      ${record.duration ? `<div class="history-work-count">ê·¼ë¬´ì‹œê°„: ${record.duration}</div>` : ''}
    </div>
  `).join('');
}

// ì¶œê·¼ ëª¨ë‹¬
function showCheckInModal() {
  const modalHtml = `
    <div id="checkInModal" class="modal" style="display: flex;">
      <div class="modal-content-large">
        <div class="modal-header">
          <div class="modal-title">ğŸ¢ ì¶œê·¼í•˜ê¸°</div>
          <button class="modal-close" onclick="closeCheckInModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">ë‹´ë‹¹ìëª…</label>
            <input type="text" class="form-input" value="${state.currentUser}" disabled>
          </div>
          <div class="form-group">
            <label class="form-label">ì¶œê·¼ ì‹œê°</label>
            <input type="time" id="checkInTime" class="form-input">
          </div>
          <div class="form-group">
            <label class="form-label">ìŒì£¼ ì¸¡ì •</label>
            <div class="radio-group">
              <div class="radio-option selected" onclick="selectAlcoholTest(this, 'confirmed')">
                <input type="radio" name="alcoholTest" value="confirmed" checked>
                <div class="radio-label">
                  <div class="radio-title">âœ“ í™•ì¸ì™„ë£Œ</div>
                </div>
              </div>
              <div class="radio-option" onclick="selectAlcoholTest(this, 'detected')">
                <input type="radio" name="alcoholTest" value="detected">
                <div class="radio-label">
                  <div class="radio-title">âœ— ì ë°œ</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="modal-btn modal-btn-primary" onclick="saveCheckIn()">ğŸ’¾ ì¶œê·¼ ë“±ë¡</button>
          <button class="modal-btn modal-btn-secondary" onclick="closeCheckInModal()">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  const now = new Date();
  const timeInput = document.getElementById('checkInTime');
  if (timeInput) {
    timeInput.value = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
  }
}

function closeCheckInModal() {
  const modal = document.getElementById('checkInModal');
  if (modal) modal.remove();
}

function saveCheckIn() {
  const time = document.getElementById('checkInTime').value;
  const alcoholTest = document.querySelector('input[name="alcoholTest"]:checked').value;
  
  if (!time) {
    alert('âš ï¸ ì¶œê·¼ ì‹œê°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (alcoholTest === 'detected') {
    alert('âš ï¸ ìŒì£¼ê°€ ì ë°œë˜ì–´ ì¶œê·¼ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.');
    closeCheckInModal();
    return;
  }
  
  const now = new Date();
  const today = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
  
  const record = {
    employee: state.currentUser,
    date: today,
    startTime: time,
    endTime: null,
    alcoholTest: alcoholTest,
    leaveType: null,
    status: 'working',
    timestamp: new Date(today + ' ' + time).toISOString()
  };
  
  state.allAttendance = state.allAttendance.filter(r => 
    !(r.employee === state.currentUser && r.date === today)
  );
  
  state.allAttendance.unshift(record);
  closeCheckInModal();
  updateMyAttendance();
  alert(`âœ“ ì¶œê·¼ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`);
}

// í‡´ê·¼ ëª¨ë‹¬
function showCheckOutModal() {
  if (!state.myAttendance || state.myAttendance.endTime) {
    alert('âš ï¸ ì¶œê·¼ ê¸°ë¡ì´ ì—†ê±°ë‚˜ ì´ë¯¸ í‡´ê·¼ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
    return;
  }
  
  const modalHtml = `
    <div id="checkOutModal" class="modal" style="display: flex;">
      <div class="modal-content-large">
        <div class="modal-header">
          <div class="modal-title">ğŸ  í‡´ê·¼í•˜ê¸°</div>
          <button class="modal-close" onclick="closeCheckOutModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">ë‹´ë‹¹ìëª…</label>
            <input type="text" class="form-input" value="${state.currentUser}" disabled>
          </div>
          <div class="form-group">
            <label class="form-label">ì¶œê·¼ ì‹œê°</label>
            <input type="text" class="form-input" value="${state.myAttendance.startTime}" disabled>
          </div>
          <div class="form-group">
            <label class="form-label">í‡´ê·¼ ì‹œê°</label>
            <input type="time" id="checkOutTime" class="form-input">
          </div>
          <div class="form-group">
            <label class="form-label">í‡´ê·¼ ì‚¬ìœ </label>
            <select id="leaveType" class="form-select">
              <option value="">ì •ìƒ í‡´ê·¼</option>
              <option value="ë°˜ì°¨">ë°˜ì°¨</option>
              <option value="ì¡°í‡´">ì¡°í‡´</option>
              <option value="ì™¸ì¶œ">ì™¸ì¶œ</option>
              <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="modal-btn modal-btn-primary" onclick="saveCheckOut()">ğŸ’¾ í‡´ê·¼ ë“±ë¡</button>
          <button class="modal-btn modal-btn-secondary" onclick="closeCheckOutModal()">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  const now = new Date();
  const timeInput = document.getElementById('checkOutTime');
  if (timeInput) {
    timeInput.value = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
  }
}

function closeCheckOutModal() {
  const modal = document.getElementById('checkOutModal');
  if (modal) modal.remove();
}

function saveCheckOut() {
  const time = document.getElementById('checkOutTime').value;
  const leaveType = document.getElementById('leaveType').value;
  
  if (!time) {
    alert('âš ï¸ í‡´ê·¼ ì‹œê°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const startTimeObj = new Date(state.myAttendance.date + ' ' + state.myAttendance.startTime);
  const endTimeObj = new Date(state.myAttendance.date + ' ' + time);
  const duration = Math.floor((endTimeObj - startTimeObj) / 1000 / 60 / 60);
  const minutes = Math.round(((endTimeObj - startTimeObj) / 1000 / 60) % 60);
  
  state.myAttendance.endTime = time;
  state.myAttendance.leaveType = leaveType || null;
  state.myAttendance.status = 'off';
  state.myAttendance.duration = `${duration}ì‹œê°„ ${minutes}ë¶„`;
  
  closeCheckOutModal();
  updateMyAttendance();
  alert(`âœ“ í‡´ê·¼ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!${leaveType ? ' (ì‚¬ìœ : ' + leaveType + ')' : ''}`);
}

function selectAlcoholTest(element, value) {
  document.querySelectorAll('.radio-option').forEach(opt => {
    opt.classList.remove('selected');
    opt.querySelector('input').checked = false;
  });
  element.classList.add('selected');
  element.querySelector('input').checked = true;
}

// ì¼ì¼ ì ê²€ì¼ì§€ íƒ­ ì „í™˜
function switchInspectionTab(index) {
  state.currentInspectionTab = index;
  
  const tabs = document.querySelectorAll('.inspection-tab');
  const contents = document.querySelectorAll('.inspection-content');
  
  tabs.forEach((tab, i) => {
    tab.classList.toggle('active', i === index);
  });
  
  contents.forEach((content, i) => {
    content.classList.toggle('active', i === index);
  });
}

// ì²´í¬ë¦¬ìŠ¤íŠ¸ í† ê¸€
function toggleCheck(el, type) {
  const checkbox = el.querySelector('input[type="checkbox"]');
  if (checkbox) {
    checkbox.checked = !checkbox.checked;
    if (checkbox.checked) {
      el.classList.add('checked');
    } else {
      el.classList.remove('checked');
    }
    
    if (type) {
      updateInspectionSummary(type);
    }
  }
}

// ì ê²€ì¼ì§€ ìš”ì•½ ì—…ë°ì´íŠ¸
function updateInspectionSummary(type) {
  const typeMap = {
    'facility': { id: 'facilityInspection', summaryId: 'facilitySummary', total: 10 },
    'site': { id: 'siteInspection', summaryId: 'siteSummary', total: 12 },
    'equipment': { id: 'equipmentInspection', summaryId: 'equipmentSummary', total: 8 }
  };
  
  const config = typeMap[type];
  if (!config) return;
  
  const container = document.getElementById(config.id);
  const checked = container.querySelectorAll('input[type="checkbox"]:checked').length;
  
  state.inspectionChecked[type] = checked;
  
  const summaryEl = document.getElementById(config.summaryId);
  if (summaryEl) {
    summaryEl.textContent = `${checked}/${config.total}`;
  }
}

// ì¼ì¼ ì ê²€ì¼ì§€ ì œì¶œ
function submitDailyInspection() {
  const tabNames = ['ì‹œì„¤ì ê²€', 'í˜„ì¥ì ê²€', 'ì¥ë¹„ì ê²€'];
  const types = ['facility', 'site', 'equipment'];
  const currentType = types[state.currentInspectionTab];
  const tabName = tabNames[state.currentInspectionTab];
  
  const checked = state.inspectionChecked[currentType] || 0;
  
  if (checked === 0) {
    alert('âš ï¸ ìµœì†Œ 1ê°œ ì´ìƒì˜ í•­ëª©ì„ ì²´í¬í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const noteEl = document.getElementById('dailyInspectionNote');
  const managerEl = document.getElementById('dailyInspectionManager');
  
  const now = new Date();
  const time = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
  const date = now.toISOString().split('T')[0];
  
  const item = {
    type: 'ì¼ì¼ì ê²€',
    inspectionType: tabName,
    checked: checked,
    manager: managerEl ? managerEl.value : state.currentUser,
    dept: userDept,
    time: time,
    startDate: date,
    photos: [],
    memo: '',
    note: noteEl ? noteEl.value : '',
    timestamp: new Date().toISOString()
  };
  
  if (uploadMode === 'instant') {
    state.workItems.push(item);
    calculateMissionWorkCounts();
    alert(`âœ“ ${tabName}ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì²´í¬: ${checked} í•­ëª©`);
  } else {
    state.queueItems.push(item);
    updateQueueBadge();
    updateQueueList();
    alert(`âœ“ ${tabName}ì´ ëŒ€ê¸°ì—´ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì²´í¬: ${checked} í•­ëª©`);
  }
  
  // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
  const containers = document.querySelectorAll('.inspection-content');
  containers[state.currentInspectionTab].querySelectorAll('.checklist-item').forEach(el => {
    const checkbox = el.querySelector('input[type="checkbox"]');
    if (checkbox) checkbox.checked = false;
    el.classList.remove('checked');
  });
  
  state.inspectionChecked[currentType] = 0;
  updateInspectionSummary(currentType);
  
  if (noteEl) noteEl.value = '';
  
  goToHome();
}

// ê¸°ë³¸ ì ê²€ ì œì¶œ
function submitInspection() {
  const roadEl = document.getElementById('inspectionRoad');
  if (!roadEl || roadEl.value === 'ì„ íƒí•´ì£¼ì„¸ìš”') {
    alert('âš ï¸ ì ê²€ ë„ë¡œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const checked = document.querySelectorAll('#inspection .checklist-item input:checked').length;
  if (checked === 0) {
    alert('âš ï¸ ìµœì†Œ 1ê°œ ì´ìƒì˜ í•­ëª©ì„ ì²´í¬í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const managerEl = document.getElementById('inspectionManager');
  const noteEl = document.getElementById('inspectionNote');
  
  const now = new Date();
  const time = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
  const date = now.toISOString().split('T')[0];
  
  const item = {
    type: 'ê¸°ë³¸ì ê²€',
    category: 'ë„ë¡œ',
    road: roadEl.value,
    checked: checked,
    manager: managerEl ? managerEl.value : state.currentUser,
    dept: userDept,
    time: time,
    startDate: date,
    photos: [],
    memo: '',
    note: noteEl ? noteEl.value : '',
    timestamp: new Date().toISOString()
  };
  
  if (uploadMode === 'instant') {
    state.workItems.push(item);
    calculateMissionWorkCounts();
    alert(`âœ“ ê¸°ë³¸ ì ê²€ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\në„ë¡œ: ${roadEl.value}\nì²´í¬: ${checked}/8 í•­ëª©`);
  } else {
    state.queueItems.push(item);
    updateQueueBadge();
    updateQueueList();
    alert(`âœ“ ê¸°ë³¸ ì ê²€ì´ ëŒ€ê¸°ì—´ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\n\në„ë¡œ: ${roadEl.value}\nì²´í¬: ${checked}/8 í•­ëª©`);
  }
  
  document.querySelectorAll('#inspection .checklist-item').forEach(el => {
    const checkbox = el.querySelector('input[type="checkbox"]');
    if (checkbox) checkbox.checked = false;
    el.classList.remove('checked');
  });
  roadEl.value = 'ì„ íƒí•´ì£¼ì„¸ìš”';
  if (noteEl) noteEl.value = '';
  
  goToHome();
}

// ìƒì„¸ ì‘ì—… ì œì¶œ
function submitWork() {
  if (state.isEditMode) {
    const index = state.editingWorkIndex;
    if (index === null || index === undefined) return;
    
    const item = state.workItems[index];
    
    item.status = document.getElementById('workStatus').value;
    item.category = document.getElementById('workCategory').value;
    item.location = document.getElementById('locationInput').value;
    item.workType = document.getElementById('workType').value;
    item.startDate = document.getElementById('startDate').value;
    item.startTime = document.getElementById('startTime').value;
    item.endDate = document.getElementById('endDate').value;
    item.endTime = document.getElementById('endTime').value;
    item.resources = document.getElementById('workResources').value;
    item.workers = document.getElementById('workers').value;
    item.detail = document.getElementById('workDetail').value;
    item.manager = document.getElementById('managerName').value;
    
    item.photoCount = photoCount;
    
    state.isEditMode = false;
    state.editingWorkIndex = null;
    resetWorkForm();
    calculateMissionWorkCounts();
    updateWorkList();
    alert('âœ“ ì‘ì—…ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
    goToList();
    return;
  }
  
  const statusEl = document.getElementById('workStatus');
  const categoryEl = document.getElementById('workCategory');
  const locationEl = document.getElementById('locationInput');
  const workTypeEl = document.getElementById('workType');
  const startDateEl = document.getElementById('startDate');
  const startTimeEl = document.getElementById('startTime');
  const endDateEl = document.getElementById('endDate');
  const endTimeEl = document.getElementById('endTime');
  const resourcesEl = document.getElementById('workResources');
  const workersEl = document.getElementById('workers');
  const detailEl = document.getElementById('workDetail');
  const managerEl = document.getElementById('managerName');
  
  if (!locationEl || !categoryEl || !workTypeEl || !detailEl || !managerEl) {
    alert('âš ï¸ í•„ìˆ˜ í•­ëª©ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  
  if (!locationEl.value || !categoryEl.value || workTypeEl.value === 'ì„ íƒí•´ì£¼ì„¸ìš”' || !detailEl.value) {
    alert('âš ï¸ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const now = new Date();
  const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
  const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
  
  const photos = [];
  const picsContainer = document.getElementById('pics');
  const photoElements = picsContainer.querySelectorAll('.photo img');
  photoElements.forEach(img => {
    photos.push(img.src);
  });
  
  const item = {
    type: 'ìƒì„¸ì ‘ìˆ˜',
    category: categoryEl.value,
    status: statusEl ? statusEl.value : 'pending',
    location: locationEl.value,
    workType: workTypeEl.value,
    startDate: startDateEl ? startDateEl.value : '',
    startTime: startTimeEl ? startTimeEl.value : '',
    endDate: endDateEl ? endDateEl.value : '',
    endTime: endTimeEl ? endTimeEl.value : '',
    resources: resourcesEl ? resourcesEl.value : '',
    workers: workersEl ? workersEl.value : '',
    detail: detailEl.value,
    manager: managerEl.value,
    dept: userDept,
    photoCount: photoCount,
    photos: photos,
    memo: '',
    timestamp: new Date().toISOString()
  };
  
  if (uploadMode === 'instant') {
    state.workItems.push(item);
    calculateMissionWorkCounts();
    alert('âœ“ ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
  } else {
    state.queueItems.push(item);
    updateQueueBadge();
    updateQueueList();
    alert('âœ“ ì‘ì—…ì´ ëŒ€ê¸°ì—´ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
  }
  
  resetWorkForm();
  goToHome();
}

// ê°„ë‹¨ ì ‘ìˆ˜ ì œì¶œ
function submitSimple() {
  if (photoCountSimple === 0) {
    alert('âš ï¸ ì‚¬ì§„ì„ ìµœì†Œ 1ì¥ ì²¨ë¶€í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const categoryEl = document.getElementById('simpleCategory');
  const locationEl = document.getElementById('simpleLocation');
  const managerEl = document.getElementById('simpleManagerName');
  
  const now = new Date();
  const time = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
  const date = now.toISOString().split('T')[0];
  
  const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
  const timeStr = time;
  const loc = locationEl ? locationEl.value || 'ìœ„ì¹˜ ë¯¸ì…ë ¥' : 'ìœ„ì¹˜ ë¯¸ì…ë ¥';
  const category = categoryEl ? categoryEl.value || '' : '';
  
  const photos = [];
  const picsContainer = document.getElementById('pics-simple');
  const photoElements = picsContainer.querySelectorAll('.photo img');
  photoElements.forEach(img => {
    photos.push(img.src);
  });
  
  const item = {
    type: 'ê°„ë‹¨ì ‘ìˆ˜',
    category: category,
    location: loc,
    manager: managerEl ? managerEl.value : state.currentUser,
    dept: userDept,
    photoCount: photoCountSimple,
    photos: photos,
    time: time,
    startDate: date,
    memo: '',
    timestamp: new Date().toISOString()
  };
  
  if (uploadMode === 'instant') {
    state.workItems.push(item);
    calculateMissionWorkCounts();
    alert('âš¡ ê°„ë‹¨ ì ‘ìˆ˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
  } else {
    state.queueItems.push(item);
    updateQueueBadge();
    updateQueueList();
    alert('âš¡ ê°„ë‹¨ ì ‘ìˆ˜ê°€ ëŒ€ê¸°ì—´ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
  }
  
  if (categoryEl) categoryEl.value = '';
  if (locationEl) locationEl.value = '';
  photoCountSimple = 0;
  document.getElementById('pics-simple').innerHTML = '<div class="add-photo-btn" onclick="showPhotoModalSimple()"><div class="add-photo-icon">ğŸ“·</div><div class="add-photo-text">ì¶”ê°€</div></div>';
  
  goToHome();
}

// ì„¤ì • ì €ì¥
function saveSettings() {
  const managerEl = document.getElementById('defaultManagerName');
  const deptEl = document.getElementById('defaultDept');
  
  if (!managerEl) return;
  
  const managerName = managerEl.value;
  if (deptEl) userDept = deptEl.value;
  
  const managerNameEl = document.getElementById('managerName');
  const simpleManagerEl = document.getElementById('simpleManagerName');
  const inspectionManagerEl = document.getElementById('inspectionManager');
  const dailyInspectionManagerEl = document.getElementById('dailyInspectionManager');
  const userNameEl = document.getElementById('userName');
  const userDeptEl = document.getElementById('userDept');
  
  if (managerNameEl) managerNameEl.value = managerName;
  if (simpleManagerEl) simpleManagerEl.value = managerName;
  if (inspectionManagerEl) inspectionManagerEl.value = managerName;
  if (dailyInspectionManagerEl) dailyInspectionManagerEl.value = managerName;
  if (userNameEl) {
    userNameEl.innerHTML = managerName + ' ë‹˜';
    if (state.isAdmin) {
      userNameEl.innerHTML += '<span class="admin-indicator">ê´€ë¦¬ì</span>';
    }
  }
  if (userDeptEl) userDeptEl.textContent = userDept;
  
  state.currentUser = managerName;
  state.userDept = userDept;
  
  updateMyAttendance();
  
  alert('âœ“ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
  goToHome();
}

function selectUploadMode(mode) {
  uploadMode = mode;
  state.uploadMode = mode;
  
  const options = document.querySelectorAll('#settings .radio-option');
  if (options[0]) {
    options[0].classList.toggle('selected', mode === 'instant');
    options[0].querySelector('input').checked = mode === 'instant';
  }
  if (options[1]) {
    options[1].classList.toggle('selected', mode === 'wifi');
    options[1].querySelector('input').checked = mode === 'wifi';
  }
  
  const warning = document.getElementById('wifiWarning');
  if (warning) {
    if (mode === 'wifi') {
      warning.classList.add('show');
    } else {
      warning.classList.remove('show');
    }
  }
  
  updateQueueBadge();
}

function toggleAdminMode(isAdmin) {
  state.isAdmin = isAdmin;
  
  const options = document.querySelectorAll('#settings .radio-option');
  const adminOptions = Array.from(options).filter(opt => 
    opt.querySelector('input[name="adminMode"]')
  );
  
  adminOptions.forEach(opt => {
    const input = opt.querySelector('input');
    if (input.value === 'admin') {
      opt.classList.toggle('selected', isAdmin);
      input.checked = isAdmin;
    } else {
      opt.classList.toggle('selected', !isAdmin);
      input.checked = !isAdmin;
    }
  });
  
  const userNameEl = document.getElementById('userName');
  if (userNameEl) {
    const currentText = userNameEl.textContent.replace(' ê´€ë¦¬ì', '');
    if (isAdmin) {
      userNameEl.innerHTML = currentText + '<span class="admin-indicator">ê´€ë¦¬ì</span>';
    } else {
      userNameEl.textContent = currentText;
    }
  }
  
  updateMyAttendance();
}

// ì‚¬ì§„ ê´€ë ¨ í•¨ìˆ˜ë“¤
function showPhotoModal() {
  if (photoCount >= 5) {
    alert('ìµœëŒ€ 5ì¥ê¹Œì§€ë§Œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    return;
  }
  currentMode = 'work';
  document.getElementById('photoModal').classList.add('show');
}

function showPhotoModalSimple() {
  if (photoCountSimple >= 5) {
    alert('ìµœëŒ€ 5ì¥ê¹Œì§€ë§Œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    return;
  }
  currentMode = 'simple';
  document.getElementById('photoModal').classList.add('show');
}

function closePhotoModal() {
  document.getElementById('photoModal').classList.remove('show');
}

function takePhoto() {
  closePhotoModal();
  addPhoto();
}

function selectPhoto() {
  closePhotoModal();
  addPhoto();
}

function addPhoto() {
  if (currentMode === 'work') {
    if (photoCount >= 5) return;
    
    photoCount++;
    const container = document.getElementById('pics');
    const photoDiv = document.createElement('div');
    photoDiv.className = 'photo';
    
    const now = new Date();
    const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
    const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
    const loc = document.getElementById('locationInput')?.value || 'ìœ„ì¹˜ ë¯¸ì…ë ¥';
    const photoData = createPhotoWithWatermark(loc, `${dateStr} ${timeStr}`, userDept);
    
    photoDiv.innerHTML = `<img src="${photoData}"><button class="photo-remove" onclick="delPhoto(this)">Ã—</button>`;
    
    const addBtn = container.querySelector('.add-photo-btn');
    if (photoCount < 5) {
      container.insertBefore(photoDiv, addBtn);
    } else {
      if (addBtn) container.removeChild(addBtn);
      container.appendChild(photoDiv);
    }
    
    document.getElementById('num').textContent = photoCount;
    
  } else {
    if (photoCountSimple >= 5) return;
    
    photoCountSimple++;
    const container = document.getElementById('pics-simple');
    const photoDiv = document.createElement('div');
    photoDiv.className = 'photo';
    
    const now = new Date();
    const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
    const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
    const loc = document.getElementById('simpleLocation')?.value || 'ìœ„ì¹˜ ë¯¸ì…ë ¥';
    const photoData = createPhotoWithWatermark(loc, `${dateStr} ${timeStr}`, userDept);
    
    photoDiv.innerHTML = `<img src="${photoData}"><button class="photo-remove" onclick="delPhotoSimple(this)">Ã—</button>`;
    
    const addBtn = container.querySelector('.add-photo-btn');
    if (photoCountSimple < 5) {
      container.insertBefore(photoDiv, addBtn);
    } else {
      if (addBtn) container.removeChild(addBtn);
      container.appendChild(photoDiv);
    }
  }
}

function delPhoto(btn) {
  btn.parentElement.remove();
  photoCount--;
  document.getElementById('num').textContent = photoCount;
  
  const container = document.getElementById('pics');
  if (!container.querySelector('.add-photo-btn')) {
    const addBtn = document.createElement('div');
    addBtn.className = 'add-photo-btn';
    addBtn.onclick = showPhotoModal;
    addBtn.innerHTML = '<div class="add-photo-icon">ğŸ“·</div><div class="add-photo-text">ì¶”ê°€</div>';
    container.appendChild(addBtn);
  }
}

function delPhotoSimple(btn) {
  btn.parentElement.remove();
  photoCountSimple--;
  
  const container = document.getElementById('pics-simple');
  if (!container.querySelector('.add-photo-btn')) {
    const addBtn = document.createElement('div');
    addBtn.className = 'add-photo-btn';
    addBtn.onclick = showPhotoModalSimple;
    addBtn.innerHTML = '<div class="add-photo-icon">ğŸ“·</div><div class="add-photo-text">ì¶”ê°€</div>';
    container.appendChild(addBtn);
  }
}

// í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜
function goToHome() { setActivePage('home'); window.scrollTo(0, 0); }
function goToWork() { 
  if (!state.isEditMode) resetWorkForm();
  setActivePage('work'); 
  window.scrollTo(0, 0); 
}
function goToSimple() { setActivePage('simple'); window.scrollTo(0, 0); }
function goToDailyInspection() { setActivePage('dailyInspection'); window.scrollTo(0, 0); }
function goToSettings() { setActivePage('settings'); window.scrollTo(0, 0); }
function goToQueue() { updateQueueList(); setActivePage('queue'); window.scrollTo(0, 0); }
function goToList() { 
  state.missionFilterActive = false;
  filterWorks('all'); 
  updatePeriodText(); 
  updateWorkList(); 
  setActivePage('list'); 
  window.scrollTo(0, 0); 
}
function goToStats() { updateStats(); setActivePage('stats'); window.scrollTo(0, 0); }
function goToInspection() { setActivePage('inspection'); window.scrollTo(0, 0); }
function goToMission() { updateMissionHistory(); setActivePage('mission'); window.scrollTo(0, 0); }
function goToAttendance() { updateMyAttendance(); setActivePage('attendance'); window.scrollTo(0, 0); }

function setActivePage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(page).classList.add('active');
}

// ì´ˆê¸°í™” ì‹¤í–‰
window.onload = init;

// ìì²´ í…ŒìŠ¤íŠ¸ ë¡œê·¸

// ì¼ì¼ì ê²€ ë³´ê³ ì„œ í‘œì‹œ
function showDailyInspectionReport(index) {
  if (index < 0 || index >= state.workItems.length) return;
  
  const item = state.workItems[index];
  if (item.type !== 'ì¼ì¼ì ê²€') return;
  
  // ë³´ê³ ì„œ ìƒì„±
  const reportHtml = generateInspectionReport(item);
  document.getElementById('reportContent').innerHTML = reportHtml;
  
  setActivePage('reportPage');
  window.scrollTo(0, 0);
}

// ë³´ê³ ì„œ HTML ìƒì„±
function generateInspectionReport(item) {
  const inspectionTypes = {
    'ì‹œì„¤ì ê²€': {
      icon: 'ğŸ—ï¸',
      color: '#FF9800',
      items: [
        'ê±´ë¬¼ ì™¸ê´€ ìƒíƒœ í™•ì¸',
        'ì¡°ëª… ì‹œì„¤ ì ê²€',
        'ì¶œì…ë¬¸ ë° ë¹„ìƒêµ¬ ì ê²€',
        'ì†Œë°© ì‹œì„¤ ì ê²€',
        'ë°°ìˆ˜ ì‹œì„¤ í™•ì¸',
        'ì°½ë¬¸ ë° ìœ ë¦¬ ìƒíƒœ',
        'ì „ê¸° ì„¤ë¹„ ì ê²€',
        'ëƒ‰ë‚œë°© ì‹œì„¤ í™•ì¸',
        'CCTV ì‘ë™ ìƒíƒœ',
        'ì•ˆì „ ì¥ë¹„ ë¹„ì¹˜ í™•ì¸'
      ]
    },
    'í˜„ì¥ì ê²€': {
      icon: 'ğŸš§',
      color: '#4CAF50',
      items: [
        'ë„ë¡œ í‘œë©´ ìƒíƒœ í™•ì¸',
        'ì¤‘ì•™ë¶„ë¦¬ëŒ€ ì ê²€',
        'ë°©ìŒë²½ ìƒíƒœ í™•ì¸',
        'í‘œì§€íŒ ë° ì•ˆë‚´íŒ ì ê²€',
        'ë„ë¡œ ì¡°ëª… ì ê²€',
        'ë°°ìˆ˜ë¡œ ë° ë§¨í™€ ì ê²€',
        'ê°“ê¸¸ ìƒíƒœ í™•ì¸',
        'ì‹ í˜¸ë“± ì‘ë™ ìƒíƒœ',
        'CCTV ì‘ë™ í™•ì¸',
        'ê°€ë“œë ˆì¼ ìƒíƒœ ì ê²€',
        'ë…¹ì§€ëŒ€ ê´€ë¦¬ ìƒíƒœ',
        'ì•ˆì „ ì‹œì„¤ ì „ë°˜ ì ê²€'
      ]
    },
    'ì¥ë¹„ì ê²€': {
      icon: 'ğŸ”§',
      color: '#2196F3',
      items: [
        'ì¤‘ì¥ë¹„ ì™¸ê´€ í™•ì¸',
        'ì—°ë£Œ ë° ì˜¤ì¼ ì ê²€',
        'ìœ ì•• ì‹œìŠ¤í…œ í™•ì¸',
        'íƒ€ì´ì–´ ë° ê¶¤ë„ ì ê²€',
        'ê²½ë³´ ì¥ì¹˜ ì‘ë™ í™•ì¸',
        'ì „ì¡°ë“± ë° í›„ë¯¸ë“± ì ê²€',
        'ì•ˆì „ ì¥ë¹„ ë¹„ì¹˜ í™•ì¸',
        'ì •ë¹„ ì´ë ¥ í™•ì¸'
      ]
    }
  };
  
  const config = inspectionTypes[item.inspectionType];
  const totalItems = config.items.length;
  const checkedPercentage = Math.round((item.checked / totalItems) * 100);
  
  return `
    <div class="report-header">
      <div class="report-title">${config.icon} ${item.inspectionType} ì¼ì¼ì ê²€ì¼ì§€</div>
      <div class="report-subtitle">ê³ ì†ë„ë¡œ ì‘ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
      <div class="report-date">ì‘ì„±ì¼: ${item.startDate} ${item.time}</div>
    </div>
    
    <div class="report-section">
      <div class="report-section-title">ğŸ“Š ì ê²€ ìš”ì•½</div>
      <div class="report-summary-grid">
        <div class="report-summary-card" style="border-left-color: ${config.color};">
          <div class="report-summary-label">ì´ ì ê²€ í•­ëª©</div>
          <div class="report-summary-value">${totalItems}ê°œ</div>
        </div>
        <div class="report-summary-card" style="border-left-color: #4CAF50;">
          <div class="report-summary-label">ì²´í¬ ì™„ë£Œ</div>
          <div class="report-summary-value">${item.checked}ê°œ</div>
        </div>
        <div class="report-summary-card" style="border-left-color: ${checkedPercentage >= 80 ? '#4CAF50' : '#FF9800'};">
          <div class="report-summary-label">ì™„ë£Œìœ¨</div>
          <div class="report-summary-value">${checkedPercentage}%</div>
        </div>
      </div>
    </div>
    
    <div class="report-section">
      <div class="report-section-title">âœ… ì ê²€ í•­ëª© ìƒì„¸</div>
      <table class="report-table">
        <thead>
          <tr>
            <th style="width: 60px;">ë²ˆí˜¸</th>
            <th>ì ê²€ í•­ëª©</th>
            <th style="width: 100px;">ìƒíƒœ</th>
          </tr>
        </thead>
        <tbody>
          ${config.items.map((checkItem, i) => `
            <tr>
              <td style="text-align: center;">${i + 1}</td>
              <td>${checkItem}</td>
              <td style="text-align: center;">
                ${i < item.checked ? 
                  '<span style="color: #4CAF50; font-weight: 700;">âœ“ ì •ìƒ</span>' : 
                  '<span style="color: #999;">- ë¯¸ì ê²€</span>'}
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
    
    ${item.note ? `
    <div class="report-section">
      <div class="report-section-title">ğŸ“ íŠ¹ì´ì‚¬í•­</div>
      <div style="padding: 20px; background: #F8F9FA; border-radius: 8px; line-height: 1.8;">
        ${item.note}
      </div>
    </div>
    ` : ''}
    
    <div class="report-footer">
      <div class="report-signature">
        <span class="report-signature-label">ì ê²€ì:</span>
        <span class="report-signature-value">${item.manager} (${item.dept})</span>
      </div>
    </div>
  `;
}


// ì‘ì—…(ê°„ë‹¨ì ‘ìˆ˜/ìƒì„¸ì ‘ìˆ˜) ë³´ê³ ì„œ í‘œì‹œ
function showWorkReport(index) {
  if (index < 0 || index >= state.workItems.length) return;
  
  const item = state.workItems[index];
  if (item.type !== 'ê°„ë‹¨ì ‘ìˆ˜' && item.type !== 'ìƒì„¸ì ‘ìˆ˜') return;
  
  const reportHtml = generateWorkReport(item);
  document.getElementById('reportContent').innerHTML = reportHtml;
  
  setActivePage('reportPage');
  window.scrollTo(0, 0);
}

// ì‘ì—… ë³´ê³ ì„œ HTML ìƒì„±
function generateWorkReport(item) {
  const isSimple = item.type === 'ê°„ë‹¨ì ‘ìˆ˜';
  const title = isSimple ? 'âš¡ ê°„ë‹¨ ì ‘ìˆ˜ ë³´ê³ ì„œ' : 'ğŸ“ ìƒì„¸ ì‘ì—… ë³´ê³ ì„œ';
  const categoryIcon = item.category === 'ì‹œì„¤' ? 'ğŸ—ï¸' : item.category === 'êµí†µ' ? 'ğŸš¦' : item.category === 'ë„ë¡œ' ? 'ğŸ›£ï¸' : '';
  
  // ì‚¬ì§„ ì„¹ì…˜ ìƒì„±
  let photoSection = '';
  if (item.photos && item.photos.length > 0) {
    photoSection = `
      <div class="report-section">
        <div class="report-section-title">ğŸ“· í˜„ì¥ ì‚¬ì§„ (${item.photos.length}ì¥)</div>
        <div class="report-photo-grid">
          ${item.photos.map((photo, idx) => `
            <div class="report-photo-item">
              <img src="${photo}" class="report-photo-img" alt="í˜„ì¥ì‚¬ì§„ ${idx + 1}">
              <div class="report-photo-info">
                <div class="report-photo-label">ì‚¬ì§„ ${idx + 1}</div>
                <div class="report-photo-value">${item.location || 'ìœ„ì¹˜ ë¯¸ì…ë ¥'}</div>
                <div class="report-photo-label" style="margin-top: 8px;">ì´¬ì˜ì¼ì‹œ</div>
                <div class="report-photo-value">${item.startDate || ''} ${item.time || item.startTime || ''}</div>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }
  
  // ìƒì„¸ì ‘ìˆ˜ ì „ìš© ì •ë³´
  let detailSection = '';
  if (!isSimple) {
    const statusText = item.status === 'completed' ? 'ì™„ë£Œ' : item.status === 'inprogress' ? 'ì§„í–‰ì¤‘' : 'ì˜ˆì •';
    const statusColor = item.status === 'completed' ? '#4CAF50' : item.status === 'inprogress' ? '#FF9800' : '#999';
    
    detailSection = `
      <div class="report-section">
        <div class="report-section-title">ğŸ“‹ ì‘ì—… ìƒì„¸ ì •ë³´</div>
        <table class="report-table">
          <tbody>
            <tr>
              <th style="width: 150px;">ì‘ì—… ìƒíƒœ</th>
              <td><span style="color: ${statusColor}; font-weight: 700;">â— ${statusText}</span></td>
            </tr>
            <tr>
              <th>ì‘ì—… ìœ í˜•</th>
              <td>${item.workType || '-'}</td>
            </tr>
            ${item.startDate ? `
            <tr>
              <th>ì‘ì—… ê¸°ê°„</th>
              <td>${item.startDate} ${item.startTime || ''} ~ ${item.endDate || ''} ${item.endTime || ''}</td>
            </tr>
            ` : ''}
            ${item.resources ? `
            <tr>
              <th>íˆ¬ì… ìì›</th>
              <td>${item.resources}</td>
            </tr>
            ` : ''}
            ${item.workers ? `
            <tr>
              <th>íˆ¬ì… ì¸ë ¥</th>
              <td>${item.workers}</td>
            </tr>
            ` : ''}
            ${item.detail ? `
            <tr>
              <th>ì‘ì—… ë‚´ìš©</th>
              <td style="white-space: pre-wrap; line-height: 1.6;">${item.detail}</td>
            </tr>
            ` : ''}
          </tbody>
        </table>
      </div>
    `;
  }
  
  return `
    <div class="report-header">
      <div class="report-title">${title}</div>
      <div class="report-subtitle">ê³ ì†ë„ë¡œ ì‘ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
      <div class="report-date">ì‘ì„±ì¼: ${item.startDate || ''} ${item.time || item.startTime || ''}</div>
    </div>
    
    <div class="report-section">
      <div class="report-section-title">ğŸ“ ê¸°ë³¸ ì •ë³´</div>
      <table class="report-table">
        <tbody>
          <tr>
            <th style="width: 150px;">ì ‘ìˆ˜ ìœ í˜•</th>
            <td>${isSimple ? 'âš¡ ê°„ë‹¨ ì ‘ìˆ˜' : 'ğŸ“ ìƒì„¸ ì ‘ìˆ˜'}</td>
          </tr>
          ${item.category ? `
          <tr>
            <th>ì‘ì—… ë¶„ë¥˜</th>
            <td>${categoryIcon} ${item.category}</td>
          </tr>
          ` : ''}
          <tr>
            <th>ì‘ì—… ìœ„ì¹˜</th>
            <td>${item.location || 'ìœ„ì¹˜ ë¯¸ì…ë ¥'}</td>
          </tr>
          <tr>
            <th>ë“±ë¡ ì¼ì‹œ</th>
            <td>${item.startDate || ''} ${item.time || item.startTime || ''}</td>
          </tr>
          <tr>
            <th>ë‹´ë‹¹ì</th>
            <td>${item.manager} (${item.dept})</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    ${detailSection}
    
    ${photoSection}
    
    <div class="report-footer">
      <div class="report-signature">
        <span class="report-signature-label">ë‹´ë‹¹ì:</span>
        <span class="report-signature-value">${item.manager} (${item.dept})</span>
      </div>
    </div>
  `;
}

// í†µí•© ë³´ê³ ì„œ ìƒì„±
function generateIntegratedReport() {
  const startDateInput = document.getElementById('reportStartDate');
  const endDateInput = document.getElementById('reportEndDate');
  
  if (!startDateInput.value || !endDateInput.value) {
    alert('âš ï¸ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const startDate = startDateInput.value;
  const endDate = endDateInput.value;
  
  if (startDate > endDate) {
    alert('âš ï¸ ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  
  // ê¸°ê°„ ë‚´ ì‘ì—… í•„í„°ë§
  const filteredItems = state.workItems.filter(item => {
    const itemDate = item.startDate || item.date;
    return itemDate && itemDate >= startDate && itemDate <= endDate;
  });
  
  // ì¶œë™ ê¸°ë¡ í•„í„°ë§
  const filteredMissions = state.missionRecords.filter(record => {
    return record.date && record.date >= startDate && record.date <= endDate;
  });
  
  // ìœ í˜•ë³„ ë¶„ë¥˜
  const dailyInspections = filteredItems.filter(item => item.type === 'ì¼ì¼ì ê²€');
  const workRecords = filteredItems.filter(item => item.type === 'ê°„ë‹¨ì ‘ìˆ˜' || item.type === 'ìƒì„¸ì ‘ìˆ˜');
  
  const reportHtml = generateIntegratedReportHTML(startDate, endDate, dailyInspections, filteredMissions, workRecords);
  document.getElementById('reportContent').innerHTML = reportHtml;
  
  setActivePage('reportPage');
  window.scrollTo(0, 0);
}

// í†µí•© ë³´ê³ ì„œ HTML ìƒì„±
function generateIntegratedReportHTML(startDate, endDate, inspections, missions, works) {
  const totalCount = inspections.length + missions.length + works.length;
  
  return `
    <div class="report-header">
      <div class="report-title">ğŸ“Š í†µí•© ì‘ì—… ë³´ê³ ì„œ</div>
      <div class="report-subtitle">ê³ ì†ë„ë¡œ ì‘ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
      <div class="report-date">ë³´ê³  ê¸°ê°„: ${startDate} ~ ${endDate}</div>
    </div>
    
    <div class="report-section">
      <div class="report-section-title">ğŸ“ˆ ê¸°ê°„ë³„ ì‘ì—… ìš”ì•½</div>
      <div class="report-summary-grid">
        <div class="report-summary-card" style="border-left-color: #2B7DE9;">
          <div class="report-summary-label">ì´ ì‘ì—… ê±´ìˆ˜</div>
          <div class="report-summary-value">${totalCount}ê±´</div>
        </div>
        <div class="report-summary-card" style="border-left-color: #9C27B0;">
          <div class="report-summary-label">ì¼ì¼ì ê²€</div>
          <div class="report-summary-value">${inspections.length}ê±´</div>
        </div>
        <div class="report-summary-card" style="border-left-color: #FF9800;">
          <div class="report-summary-label">ì¶œë™ê¸°ë¡</div>
          <div class="report-summary-value">${missions.length}ê±´</div>
        </div>
        <div class="report-summary-card" style="border-left-color: #4CAF50;">
          <div class="report-summary-label">ì‘ì—…ê¸°ë¡</div>
          <div class="report-summary-value">${works.length}ê±´</div>
        </div>
      </div>
    </div>
    
    ${inspections.length > 0 ? generateInspectionSection(inspections) : ''}
    
    ${missions.length > 0 ? generateMissionSection(missions) : ''}
    
    ${works.length > 0 ? generateWorkSection(works) : ''}
    
    ${totalCount === 0 ? '<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><div class="empty-text">í•´ë‹¹ ê¸°ê°„ì— ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div></div>' : ''}
    
    <div class="report-footer">
      <div class="report-signature">
        <span class="report-signature-label">ë³´ê³ ì„œ ìƒì„±ì¼:</span>
        <span class="report-signature-value">${new Date().toISOString().split('T')[0]}</span>
      </div>
    </div>
  `;
}

// ì¼ì¼ì ê²€ ì„¹ì…˜ ìƒì„±
function generateInspectionSection(inspections) {
  return `
    <hr class="report-divider">
    
    <div class="report-type-section">
      <div class="report-type-header">
        <div class="report-type-title">ğŸ“‹ ì¼ì¼ì ê²€ì¼ì§€</div>
        <div class="report-type-count">ì´ ${inspections.length}ê±´</div>
      </div>
      
      <table class="report-table">
        <thead>
          <tr>
            <th style="width: 50px;">ë²ˆí˜¸</th>
            <th style="width: 120px;">ì ê²€ ìœ í˜•</th>
            <th style="width: 100px;">ì ê²€ì¼</th>
            <th style="width: 80px;">ì ê²€ í•­ëª©</th>
            <th>íŠ¹ì´ì‚¬í•­</th>
            <th style="width: 120px;">ì ê²€ì</th>
          </tr>
        </thead>
        <tbody>
          ${inspections.map((item, idx) => {
            const icon = item.inspectionType === 'ì‹œì„¤ì ê²€' ? 'ğŸ—ï¸' : item.inspectionType === 'í˜„ì¥ì ê²€' ? 'ğŸš§' : 'ğŸ”§';
            return `
              <tr>
                <td style="text-align: center;">${idx + 1}</td>
                <td>${icon} ${item.inspectionType}</td>
                <td>${item.startDate}</td>
                <td style="text-align: center;">${item.checked}ê°œ ì™„ë£Œ</td>
                <td>${item.note || '-'}</td>
                <td>${item.manager}</td>
              </tr>
            `;
          }).join('')}
        </tbody>
      </table>
    </div>
  `;
}

// ì¶œë™ê¸°ë¡ ì„¹ì…˜ ìƒì„±
function generateMissionSection(missions) {
  return `
    <hr class="report-divider">
    
    <div class="report-type-section">
      <div class="report-type-header">
        <div class="report-type-title">ğŸš¨ ì¶œë™ ê¸°ë¡</div>
        <div class="report-type-count">ì´ ${missions.length}ê±´</div>
      </div>
      
      <table class="report-table">
        <thead>
          <tr>
            <th style="width: 50px;">ë²ˆí˜¸</th>
            <th style="width: 120px;">ì¶œë™ì¼</th>
            <th style="width: 80px;">ì¶œë™ì‹œê°</th>
            <th style="width: 80px;">ë³µê·€ì‹œê°</th>
            <th style="width: 100px;">ì†Œìš”ì‹œê°„</th>
            <th style="width: 80px;">ì²˜ë¦¬ê±´ìˆ˜</th>
          </tr>
        </thead>
        <tbody>
          ${missions.map((record, idx) => `
            <tr>
              <td style="text-align: center;">${idx + 1}</td>
              <td>${record.date}</td>
              <td>${record.startTime}</td>
              <td>${record.endTime || '-'}</td>
              <td>${record.duration || '-'}</td>
              <td style="text-align: center;">${record.workCount || 0}ê±´</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;
}

// ì‘ì—…ê¸°ë¡ ì„¹ì…˜ ìƒì„±
function generateWorkSection(works) {
  return `
    <hr class="report-divider">
    
    <div class="report-type-section">
      <div class="report-type-header">
        <div class="report-type-title">ğŸ“ ì‘ì—… ê¸°ë¡</div>
        <div class="report-type-count">ì´ ${works.length}ê±´</div>
      </div>
      
      <table class="report-table">
        <thead>
          <tr>
            <th style="width: 50px;">ë²ˆí˜¸</th>
            <th style="width: 100px;">ì ‘ìˆ˜ìœ í˜•</th>
            <th>ì‘ì—…ìœ„ì¹˜</th>
            <th style="width: 120px;">ì‘ì—…ë‚´ìš©</th>
            <th style="width: 100px;">ì‘ì—…ì¼</th>
            <th style="width: 80px;">ì‚¬ì§„</th>
            <th style="width: 100px;">ë‹´ë‹¹ì</th>
          </tr>
        </thead>
        <tbody>
          ${works.map((item, idx) => {
            const typeText = item.type === 'ê°„ë‹¨ì ‘ìˆ˜' ? 'âš¡ ê°„ë‹¨ì ‘ìˆ˜' : 'ğŸ“ ìƒì„¸ì ‘ìˆ˜';
            const categoryIcon = item.category === 'ì‹œì„¤' ? 'ğŸ—ï¸' : item.category === 'êµí†µ' ? 'ğŸš¦' : item.category === 'ë„ë¡œ' ? 'ğŸ›£ï¸' : '';
            return `
              <tr>
                <td style="text-align: center;">${idx + 1}</td>
                <td>${typeText}</td>
                <td>${categoryIcon} ${item.location || '-'}</td>
                <td>${item.workType || item.detail || '-'}</td>
                <td>${item.startDate || '-'}</td>
                <td style="text-align: center;">${item.photoCount || 0}ì¥</td>
                <td>${item.manager}</td>
              </tr>
            `;
          }).join('')}
        </tbody>
      </table>
    </div>
  `;
}

// ë³´ê³ ì„œ ì¸ì‡„
function printReport() {
  window.print();
}

// ë³´ê³ ì„œ ë‹«ê¸°
function closeReport() {
  goToList();
}

console.log('=== ê³ ì†ë„ë¡œ ì‘ì—…ê´€ë¦¬ v11.0 ì‹œìŠ¤í…œ ì ê²€ ===');
console.log('âœ“ ë”ë¯¸ ë°ì´í„° ë¡œë“œ ì™„ë£Œ (ìœ í˜• ì¶”ê°€)');
console.log('âœ“ ìœ í˜•ë³„ í†µê³„ (ì‹œì„¤/êµí†µ/ë„ë¡œ) ì¤€ë¹„');
console.log('âœ“ ì²˜ë¦¬í˜„í™© (ì™„ë£Œ/ì§„í–‰ì¤‘) í‘œì‹œ ì¤€ë¹„');
console.log('âœ“ ì¼ì¼ ì ê²€ì¼ì§€ (ì‹œì„¤/í˜„ì¥/ì¥ë¹„) ì¤€ë¹„');
console.log('âœ“ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ í™œì„±í™”');
console.log('âœ“ ì¶œë™ ì‹œê°„ëŒ€ ì‘ì—… í•„í„°ë§ ì¤€ë¹„');
console.log('âœ“ ê·¼íƒœê´€ë¦¬ ì‹œìŠ¤í…œ (ìŒì£¼ì²´í¬, í‡´ê·¼ì‚¬ìœ ) ì¤€ë¹„');
console.log('âœ“ ì‘ì—… ìˆ˜ì • ëª¨ë“œ (ë“±ë¡í™”ë©´ ë™ì¼) ì¤€ë¹„');
console.log('============================================');
</script>


<!-- ë³´ê³ ì„œ ì¶œë ¥ í˜ì´ì§€ -->
<div id="reportPage" class="page">
  <div class="top-bar no-print">
    <button class="back-btn" onclick="closeReport()">â†</button>
    <div class="page-title">ğŸ“„ ì ê²€ ë³´ê³ ì„œ</div>
  </div>
  
  <div id="reportContent" class="report-container"></div>
  
  <div class="report-actions no-print">
    <button class="report-btn report-btn-print" onclick="printReport()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
    <button class="report-btn report-btn-close" onclick="closeReport()">ë‹«ê¸°</button>
  </div>
</div>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
        // ë“±ë¡ ì„±ê³µ!
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }, function(err) {
        // ë“±ë¡ ì‹¤íŒ¨ :(
        console.log('ServiceWorker registration failed: ', err);
      });
    });
  }
</script>
</body>
</html>